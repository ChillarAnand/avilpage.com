<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="author" content="Chillar Anand">
<title>Detecting USB Events In Ubuntu With Python | Avil Page</title>
<link href="../../../assets/css/rst.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/theme.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/style.css" rel="stylesheet" type="text/css">
<link rel="canonical" href="http://www.avilpage.com/2016/09/detecting-device-events-in-ubuntu-with-python/">
<!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
    <![endif]--><link rel="alternate" type="application/rss+xml" title="RSS" href="../../../rss.xml">
</head>
<body>
        <div id="">
            <div id="container">
                <!-- <h1 id="blog-title">
                     <a href="http://www.avilpage.com/" title="Avil Page" rel="home">Avil Page</a>
                     </h1> -->



    <div class="postbox">


        <article class="postbox post-text"><div class="h-entry" itemscope="itemscope" itemtype="http://schema.org/Article">
                    <h1 class="p-name" itemprop="headline name">Detecting USB Events In Ubuntu With Python</h1>

                <hr>
<div class="e-content" itemprop="articleBody text">
                    <div>
<p><a href="https://en.wikipedia.org/wiki/Udev">udev</a> is responsible for managing devices on Linux. It provides <code>udevadm</code>, a CLI utility to monitor and control devices.</p>
<p>If we run <code>udevadm monitor</code> on terminal and connect a USB drive or hard disk or a mobile via USB to your computer, it will show that kernel has detected the device and it will send a signal to udev about it.</p>
<pre class="code literal-block"><span></span>â†’ udevadm monitor
monitor will print the received events <span class="k">for</span>:
UDEV - the event which udev sends out after rule processing
KERNEL - the kernel uevent

KERNEL<span class="o">[</span>4336.899091<span class="o">]</span> add      /devices/pci0000:00/0000:00:14.0/usb1/1-2 <span class="o">(</span>usb<span class="o">)</span>
KERNEL<span class="o">[</span>4336.899774<span class="o">]</span> add      /devices/pci0000:00/0000:00:14.0/usb1/1-2/1-2:1.0 <span class="o">(</span>usb<span class="o">)</span>
KERNEL<span class="o">[</span>4336.902553<span class="o">]</span> add      /devices/pci0000:00/0000:00:14.0/usb1/1-2/1-2:1.1 <span class="o">(</span>usb<span class="o">)</span>
UDEV  <span class="o">[</span>4336.911201<span class="o">]</span> add      /devices/pci0000:00/0000:00:14.0/usb1/1-2 <span class="o">(</span>usb<span class="o">)</span>
UDEV  <span class="o">[</span>4336.936453<span class="o">]</span> add      /devices/pci0000:00/0000:00:14.0/usb1/1-2/1-2:1.1 <span class="o">(</span>usb<span class="o">)</span>
UDEV  <span class="o">[</span>4337.947174<span class="o">]</span> add      /devices/pci0000:00/0000:00:14.0/usb1/1-2/1-2:1.0 <span class="o">(</span>usb<span class="o">)</span>
</pre>


<p><a href="https://pypi.python.org/pypi/pyudev">Pyudev</a>, a third party package provides python bindings for udev. It can be installed with <code>pip install pyudev</code>.</p>
<p>With this we can create a simple monitor to detect USB events.</p>
<pre class="code literal-block"><span></span><span class="kn">import</span> <span class="nn">pyudev</span>

<span class="n">context</span> <span class="o">=</span> <span class="n">pyudev</span><span class="o">.</span><span class="n">Context</span><span class="p">()</span>
<span class="n">monitor</span> <span class="o">=</span> <span class="n">pyudev</span><span class="o">.</span><span class="n">Monitor</span><span class="o">.</span><span class="n">from_netlink</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
<span class="n">monitor</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">subsystem</span><span class="o">=</span><span class="s1">'usb'</span><span class="p">)</span>

<span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="n">monitor</span><span class="o">.</span><span class="n">poll</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">device</span><span class="o">.</span><span class="n">action</span> <span class="o">==</span> <span class="s1">'add'</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">'{} connected'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">device</span><span class="p">))</span>
        <span class="c1"># do something</span>
</pre>


<p>Save this to a file say monitor.py and run it with <code>python monitor.py</code> and connect a mobile or pendrive and it will show something like this.</p>
<pre class="code literal-block"><span></span>Device<span class="o">(</span><span class="s1">'/sys/devices/pci0000:00/0000:00:14.0/usb1/1-6/1-6:1.0'</span><span class="o">)</span> connected
Device<span class="o">(</span><span class="s1">'/sys/devices/pci0000:00/0000:00:14.0/usb1/1-1/1-1:1.0'</span><span class="o">)</span> connected
</pre>


<p>Here we are just detecting <code>add</code> event. Similary we can detect other events like <code>delete</code>.</p>
<p>This is useful for automatically running shell scripts once the device gets plugged or unplugged.</p>
</div>
                </div>
            </div>

            <hr>
<a href="../../../">
                <h2>See all articles</h2>
            </a>

            <a href="../../../rss.xml">
                <h3>RSS</h3>
            </a>


        </article>
</div>


                <br>
</div>


            <!--Sidebar content-->
            <!-- <ul class="unstyled">
                     

                                 <li><a href="/">Articles</a>
                <li><a href="/about">About.html</a>
                <li><a href="/rss.xml">RSS</a>

                 </ul> -->
            <br>
</div>
    </body>
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                             m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-81644162-1', 'auto');
    ga('send', 'pageview');

    </script>
</html>
