<!DOCTYPE html>
<html prefix="
og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="How to train LLM (like ChatGPT, Vicuna) with custom documents on the laptop.">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Train LLMs with Custom Dataset on Laptop | Avil Page</title>
<link href="../../assets/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/baguetteBox.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/rst.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/theme.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../rss.xml">
<link rel="canonical" href="https://avilpage.com/2023/07/train-llm-custom-data-laptop.html">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Chillar Anand">
<link rel="prev" href="../06/pycharm-debug-python-app-in-docker.html" title="Remote Debug Docker Container with PyCharm" type="text/html">
<link rel="next" href="../08/rearrange-csv-columns-alphabetically-cli.html" title="Rearrange CSV columns alphabetically from CLI" type="text/html">
<meta property="og:site_name" content="Avil Page">
<meta property="og:title" content="Train LLMs with Custom Dataset on Laptop">
<meta property="og:url" content="https://avilpage.com/2023/07/train-llm-custom-data-laptop.html">
<meta property="og:description" content="How to train LLM (like ChatGPT, Vicuna) with custom documents on the laptop.">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2023-07-07T04:36:42+05:30">
<meta property="article:tag" content="artificial-intelligence">
<meta property="article:tag" content="python">
<style>
    .full-article-footer {
    border-top: 1px solid #E0DFDB;
}


.article-footer {
    padding: 20px 10px 10px 10px;
    min-height: 115px;
    display:table;
}


.avatar-module {
    display: table-cell;
    vertical-align: middle;
}


.avatar-module img {
    border-radius: 50%!important;
    height: 120px;
    width: 120px;
    float: left;
    margin:0px 20px 0px 20px;
}


.article-footer p {
    line-height:1.5em;
    padding-left:15px;
}


@media (max-width:750px) {
    .article-footer {
        display:inherit;
        margin:0px;
    }

    .avatar-module {
        display:inherit;
        vertical-align: none;
    }

    .avatar-module img {
        margin-left: auto;
        margin-right: auto;
        display: block;
        float:none;
        margin-top:0px;
    }

    .article-footer p {
        text-align:center;
        padding-left:0px;
    }
}

    </style>
<style>

 h1 {
     font-weight: bold;
     font-size: 25px;
 }

</style>
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

    <!-- Menubar -->
    <nav class="navbar navbar-expand-md static-top mb-4
                navbar-dark
                bg-dark
                "><div class="container">
<!-- This keeps the margins nice -->
            <a class="navbar-brand" href="../../">

                    <span id="blog-title">Avil Page</span>
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="bs-navbar">
                <ul class="navbar-nav mr-auto">
<li class="nav-item">
<a href="../../archive.html" class="nav-link">Blog</a>
                </li>
<li class="nav-item">
<a href="../../talks.html" class="nav-link">Talks</a>
                </li>
<li class="nav-item">
<a href="../../projects.html" class="nav-link">Projects</a>
                </li>
<li class="nav-item">
<a href="../../rss.xml" class="nav-link">RSS</a>

                    
                </li>
</ul>
<ul class="navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
        </div>
<!-- /.container -->
    </nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="row justify-content-md-center">
        <div class="body-content col col-lg-6">
            <!--Body content-->
            
    <article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="#" class="u-url">Train LLMs with Custom Dataset on Laptop</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card">
                <span class="byline-name fn p-name" itemprop="author">
                    Chillar Anand
                </span>
            </p>

            <p class="dateline">
                    4 min read
            </p>

            <p class="dateline">
                <a href="#" rel="bookmark">
                    <time class="published dt-published" datetime="2023-07-07T04:36:42+05:30" itemprop="datePublished" title="2023-07-07">2023-07-07</time></a>
            </p>
            
        </div>

        
    </header><div class="e-content entry-content" itemprop="articleBody text">
            <h4>Problem Statement</h4>
<p>I want to train a Large Language Model(LLM)<sup id="fnref:LLM"><a class="footnote-ref" href="train-llm-custom-data-laptop.html#fn:LLM">1</a></sup> with some private documents and query various details.</p>
<h4>Journey</h4>
<p>There are open-source available LLMs like Vicuna, LLaMa, etc which can be trained on custom data. However, training these models on custom data is not a trivial task.</p>
<p>After trying out various methods, I ended up using privateGPT<sup id="fnref:privateGPT"><a class="footnote-ref" href="train-llm-custom-data-laptop.html#fn:privateGPT">2</a></sup> which is quite easy to train on custom documents. There is no need to format or clean up the data as privateGPT can directly consume documents in many formats like txt, html, epub, pdf, etc.</p>
<h4>Training</h4>
<p>First, let's clone the repo, install requirements.txt and download the default model.</p>
<pre class="code literal-block">$ git clone https://github.com/imartinez/privateGPT
$ <span class="nb">cd</span> privateGPT
$ pip3 install -r requirements.txt
$ wget https://gpt4all.io/models/ggml-gpt4all-j-v1.3-groovy.bin

$ cp example.env .env
$ cat .env
<span class="nv">MODEL_TYPE</span><span class="o">=</span>GPT4All
<span class="nv">MODEL_PATH</span><span class="o">=</span>ggml-gpt4all-j-v1.3-groovy.bin
</pre>
<p>I have sourced all documents and kept them in a folder called <code>docs</code>. Let's ingest(train) the data.</p>
<pre class="code literal-block">$ cp ~/docs/* source_documents

$ python ingest.py
</pre>
<p>This will take a while depending on the number of documents we have. Once the ingestion is done, we can start querying the model.</p>
<pre class="code literal-block">$ python privateGPT.py
Enter a query: Summarise about Gaaliveedu
</pre>
<p>The default <code>GPT4All-J v1.3-groovy</code><sup id="fnref:gpt4all"><a class="footnote-ref" href="train-llm-custom-data-laptop.html#fn:gpt4all">3</a></sup> model doesn't provide good results. We can easily swap it with <code>LlamaCpp</code><sup id="fnref:llama.cpp"><a class="footnote-ref" href="train-llm-custom-data-laptop.html#fn:llama.cpp">4</a></sup>. Lets download the model and convert it.</p>
<pre class="code literal-block">$ git clone https://huggingface.co/openlm-research/open_llama_13b

$ git clone https://github.com/ggerganov/llama.cpp.git
$ <span class="nb">cd</span> llama.cpp
$ python convert.py ../open_llama_13b
Wrote ../open_llama_13b/ggml-model-f16.bin
</pre>
<p>We can now update the <code>.env</code> file to use the new model and start querying again.</p>
<pre class="code literal-block">$ cat .env
<span class="nv">MODEL_TYPE</span><span class="o">=</span>LlamaCpp
<span class="nv">MODEL_PATH</span><span class="o">=</span>/path/to/ggml-model-f16.bin

$ python privateGPT.py
Enter a query: Summarise about Gaaliveedu
</pre>
<h4>Conclusion</h4>
<p>This makes it easy to build domain-specific LLMs and use them for various tasks. I have used this to build a chatbot for my internal docs and it is working well.</p>
<div class="footnote">
<hr>
<ol>
<li id="fn:LLM">
<p><a href="https://en.wikipedia.org/wiki/Large_language_model">https://en.wikipedia.org/wiki/Large_language_model</a> <a class="footnote-backref" href="train-llm-custom-data-laptop.html#fnref:LLM" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn:privateGPT">
<p><a href="https://github.com/imartinez/privateGPT">https://github.com/imartinez/privateGPT</a> <a class="footnote-backref" href="train-llm-custom-data-laptop.html#fnref:privateGPT" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
<li id="fn:gpt4all">
<p><a href="https://github.com/nomic-ai/gpt4all">https://github.com/nomic-ai/gpt4all</a> <a class="footnote-backref" href="train-llm-custom-data-laptop.html#fnref:gpt4all" title="Jump back to footnote 3 in the text">↩</a></p>
</li>
<li id="fn:llama.cpp">
<p><a href="https://github.com/ggerganov/llama.cpp">https://github.com/ggerganov/llama.cpp</a> <a class="footnote-backref" href="train-llm-custom-data-laptop.html#fnref:llama.cpp" title="Jump back to footnote 4 in the text">↩</a></p>
</li>
</ol>
</div>
        </div>

            <hr>
            Need further help with this? <a href="https://forms.gle/Hre4z4aLqJA5zYWe6">I am available for hire</a>.
            <hr>
<aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../tags/artificial-intelligence.html" rel="tag">artificial-intelligence</a></li>
            <li><a class="tag p-category" href="../../tags/python.html" rel="tag">python</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../06/pycharm-debug-python-app-in-docker.html" rel="prev" title="Remote Debug Docker Container with PyCharm">Previous post</a>
            </li>
            <li class="next">
                <a href="../08/rearrange-csv-columns-alphabetically-cli.html" rel="next" title="Rearrange CSV columns alphabetically from CLI">Next post</a>
            </li>
        </ul></nav></aside><div class="full-article-footer">
            <div class="article-footer">

                <div class="avatar-module">
                    <img class="avatar" height="100px" src="../../images/chillaranand.jpg">
</div>

                <p class="avatar-module">
                    <b>Chillar Anand</b>
                    <br>
                    A blog about python, careers &amp; life.
                    <br>
                    To contact me, <a href="https://forms.gle/Hre4z4aLqJA5zYWe6">send a message here</a>.
                </p>

            </div>
        </div>

        
    </article><!--End of body content--><footer id="footer"><div class="container align-items-center justify-content-center d-flex">

<footer class="footer"><a href="https://github.com/ChillarAnand">
<img src="../../images/icons8-github.svg" alt="github-chillar-anand" height="34"></a>

  

<a href="https://stackoverflow.com/users/2698552/chillar-anand">
<img src="../../images/icons8-so.svg" alt="github-chillar-anand" height="30"></a>

  

<a href="https://youtube.com/@avilpage">
<img src="../../images/icons8-youtube.svg" alt="github-chillar-anand" height="34"></a>

  

<a href="https://linkedin.com/in/chillaranand">
<img src="../../images/icons8-linkedin.svg" alt="github-chillar-anand" height="34"></a>

  

<a href="https://twitter.com/chillaranand">
<img src="../../images/icons8-twitter.svg" alt="github-chillar-anand" height="34"></a>

</footer>
</div>

<br><br></footer>
</div>
    </div>
    </div>

                <script src="../../assets/js/jquery.min.js"></script><script src="../../assets/js/popper.min.js"></script><script src="../../assets/js/bootstrap.min.js"></script><script src="../../assets/js/baguetteBox.min.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
    </script>
</body>
</html>
