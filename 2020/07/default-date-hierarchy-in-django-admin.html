<!DOCTYPE html>
<html prefix="
og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="How to set a default date for date hierarchy drill down in django admin page for a model?">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Set Default Date For Date Hierarchy In Django Admin | Avil Page</title>
<link href="../../assets/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/baguetteBox.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/rst.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/theme.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../rss.xml">
<link rel="canonical" href="https://avilpage.com/2020/07/default-date-hierarchy-in-django-admin.html">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Chillar Anand">
<link rel="prev" href="../06/how-dart-flutter-hot-reload-work-part-1.html" title="How Dart, Flutter Stateful Hot Reload Work? - Part 1" type="text/html">
<link rel="next" href="../08/bluetooth-terminal-python-asyncio.html" title="Serial Bluetooth Terminal With Python Asyncio" type="text/html">
<meta property="og:site_name" content="Avil Page">
<meta property="og:title" content="Set Default Date For Date Hierarchy In Django Admin">
<meta property="og:url" content="https://avilpage.com/2020/07/default-date-hierarchy-in-django-admin.html">
<meta property="og:description" content="How to set a default date for date hierarchy drill down in django admin page for a model?">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2020-07-31T20:06:49+05:30">
<meta property="article:tag" content="django">
<style>
    .full-article-footer {
    border-top: 1px solid #E0DFDB;
}


.article-footer {
    padding: 20px 10px 10px 10px;
    min-height: 115px;
    display:table;
}


.avatar-module {
    display: table-cell;
    vertical-align: middle;
}


.avatar-module img {
    border-radius: 50%!important;
    height: 120px;
    width: 120px;
    float: left;
    margin:0px 20px 0px 20px;
}


.article-footer p {
    line-height:1.5em;
    padding-left:15px;
}


@media (max-width:750px) {
    .article-footer {
        display:inherit;
        margin:0px;
    }

    .avatar-module {
        display:inherit;
        vertical-align: none;
    }

    .avatar-module img {
        margin-left: auto;
        margin-right: auto;
        display: block;
        float:none;
        margin-top:0px;
    }

    .article-footer p {
        text-align:center;
        padding-left:0px;
    }
}

    </style>
<style>

 h1 {
     font-weight: bold;
     font-size: 25px;
 }

</style>
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

    <!-- Menubar -->
    <nav class="navbar navbar-expand-md static-top mb-4
                navbar-dark
                bg-dark
                "><div class="container">
<!-- This keeps the margins nice -->
            <a class="navbar-brand" href="../../">

                    <span id="blog-title">Avil Page</span>
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="bs-navbar">
                <ul class="navbar-nav mr-auto">
<li class="nav-item">
<a href="../../guides.html" class="nav-link">Guides</a>
                </li>
<li class="nav-item">
<a href="../../archive.html" class="nav-link">Blog</a>
                </li>
<li class="nav-item">
<a href="../../books.html" class="nav-link">Books</a>
                </li>
<li class="nav-item">
<a href="../../talks.html" class="nav-link">Talks</a>
                </li>
<li class="nav-item">
<a href="../../projects.html" class="nav-link">Projects</a>
                </li>
<li class="nav-item">
<a href="../../rss.xml" class="nav-link">RSS</a>

                    
                </li>
</ul>
<ul class="navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
        </div>
<!-- /.container -->
    </nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="row justify-content-md-center">
        <div class="body-content col col-lg-6">
            <!--Body content-->
            
    <article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="#" class="u-url">Set Default Date For Date Hierarchy In Django Admin</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card">
                <span class="byline-name fn p-name" itemprop="author">
                    Chillar Anand
                </span>
            </p>

            <p class="dateline">
                    7 min read
            </p>

            <p class="dateline">
                <a href="#" rel="bookmark">
                    <time class="published dt-published" datetime="2020-07-31T20:06:49+05:30" itemprop="datePublished" title="2020-07-31">2020-07-31</time></a>
            </p>
            
        </div>

        
    </header><div class="e-content entry-content" itemprop="articleBody text">
            <h4>Introduction</h4>
<p>When we monitor daily events from django admin, most of the time we are interested in events related to today. Django admin provides date based drill down navigation page via ModelAdmin.date_hierarchy<sup id="fnref:dh"><a class="footnote-ref" href="default-date-hierarchy-in-django-admin.html#fn:dh">1</a></sup> option. With this, we can navigate to any date to filter out events related to that date.</p>
<p>One problem with this drill down navigation is, we have to navigate to todays date every time we open a model in admin. Since we are interested in todays events most of the time, setting todays date as default filtered date will solve the problem.</p>
<h4>Set Default Date For Date Hierarchy</h4>
<p>Let us create an admin page to show all the users who logged in today. Since User model is already registered in admin by default, let us create a proxy model to register it again.</p>
<div class="code"><pre class="code literal-block"><span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib.auth.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">User</span>


<span class="k">class</span><span class="w"> </span><span class="nc">DjangoUser</span><span class="p">(</span><span class="n">User</span><span class="p">):</span>
    <span class="k">class</span><span class="w"> </span><span class="nc">Meta</span><span class="p">:</span>
        <span class="n">proxy</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>

<p>Lets register this model in admin to show logged in users details along with date hierarchy.</p>
<div class="code"><pre class="code literal-block"><span class="kn">from</span><span class="w"> </span><span class="nn">django.contrib</span><span class="w"> </span><span class="kn">import</span> <span class="n">admin</span>


<span class="nd">@admin</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">DjangoUser</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">MetaUserAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">list_display</span> <span class="o">=</span> <span class="p">(</span><span class="s1">'username'</span><span class="p">,</span> <span class="s1">'is_active'</span><span class="p">,</span> <span class="s1">'last_login'</span><span class="p">)</span>
    <span class="n">date_hierarchy</span> <span class="o">=</span> <span class="s1">'last_login'</span>
</pre></div>

<p>If we open <code>DjangoUser</code> model in admin page, it will show drill down navigation bar like this.</p>
<p><img src="../../images/django-admin-date.png"></p>
<p>Now, if we drill down to a particular date, django adds additional query params to the admin url. For example, if we visit 2020-06-26 date, corresponding query params are <code>/?last_login__day=26&amp;last_login__month=6&amp;last_login__year=2020</code>.</p>
<p>We can override changelist view and set default params to todays date if there are no query params. If there are query params then render the original response.</p>
<div class="code"><pre class="code literal-block"><span class="nv">@admin</span><span class="p">.</span><span class="n">register</span><span class="p">(</span><span class="n">DjangoUser</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="n">MetaUserAdmin</span><span class="p">(</span><span class="k">admin</span><span class="p">.</span><span class="n">ModelAdmin</span><span class="p">)</span><span class="err">:</span>
<span class="w">    </span><span class="n">list_display</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="s1">'username'</span><span class="p">,</span><span class="w"> </span><span class="s1">'is_active'</span><span class="p">,</span><span class="w"> </span><span class="s1">'last_login'</span><span class="p">)</span>
<span class="w">    </span><span class="n">date_hierarchy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'last_login'</span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">changelist_view</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">extra_context</span><span class="o">=</span><span class="k">None</span><span class="p">)</span><span class="err">:</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">request</span><span class="p">.</span><span class="k">GET</span><span class="err">:</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">super</span><span class="p">().</span><span class="n">changelist_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">extra_context</span><span class="o">=</span><span class="n">extra_context</span><span class="p">)</span>

<span class="w">        </span><span class="nc">date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">now</span><span class="p">().</span><span class="nc">date</span><span class="p">()</span>
<span class="w">        </span><span class="n">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">'day', 'month', 'year'</span><span class="o">]</span>
<span class="w">        </span><span class="n">field_keys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">'{}__{}'.format(self.date_hierarchy, i) for i in params</span><span class="o">]</span>
<span class="w">        </span><span class="n">field_values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">getattr(date, i) for i in params</span><span class="o">]</span>
<span class="w">        </span><span class="n">query_params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dict</span><span class="p">(</span><span class="n">zip</span><span class="p">(</span><span class="n">field_keys</span><span class="p">,</span><span class="w"> </span><span class="n">field_values</span><span class="p">))</span>
<span class="w">        </span><span class="n">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'{}?{}'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="k">path</span><span class="p">,</span><span class="w"> </span><span class="n">urlencode</span><span class="p">(</span><span class="n">query_params</span><span class="p">))</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">redirect</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</pre></div>

<p>Now if we open the same admin page, it will redirect to todays date by default.</p>
<p><img src="../../images/django-admin-date2.png"></p>
<h4>Conclusion</h4>
<p>In this article, we have seen how to set a default date for <code>date_hierarchy</code> in admin page. We can also achieve similar filtering by settiing default values for <code>search_filter</code> or <code>list_filter</code> which will filter items related to any specific date.</p>
<div class="footnote">
<hr>
<ol>
<li id="fn:dh">
<p><a href="https://docs.djangoproject.com/en/3.0/ref/contrib/admin/#django.contrib.admin.ModelAdmin.date_hierarchy">Django docs - ModelAdmin.date_hierarchy</a> <a class="footnote-backref" href="default-date-hierarchy-in-django-admin.html#fnref:dh" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>
        </div>

            <hr>
            Need further help with this? <a href="https://forms.gle/Hre4z4aLqJA5zYWe6">Feel free to send a message</a>.
            <hr>
<aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../tags/django.html" rel="tag">django</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../06/how-dart-flutter-hot-reload-work-part-1.html" rel="prev" title="How Dart, Flutter Stateful Hot Reload Work? - Part 1">Previous post</a>
            </li>
            <li class="next">
                <a href="../08/bluetooth-terminal-python-asyncio.html" rel="next" title="Serial Bluetooth Terminal With Python Asyncio">Next post</a>
            </li>
        </ul></nav></aside></article><!--End of body content--><footer id="footer"><div class="full-article-footer">
    <div class="article-footer">

        <div class="avatar-module">
            <img class="avatar" height="100px" src="../../images/chillaranand.jpg">
</div>

        <p class="avatar-module">
            <b>Chillar Anand</b>
            <br>
            Improving Health &amp; Wealth with Technology
            <br></p>

    </div>
</div>

<div class="container align-items-center justify-content-center d-flex">

<footer class="footer"><a href="https://github.com/ChillarAnand">
<img src="../../images/icons8-github.svg" alt="github-chillar-anand" height="34"></a>

  

<a href="https://stackoverflow.com/users/2698552/chillar-anand">
<img src="../../images/icons8-so.svg" alt="github-chillar-anand" height="30"></a>

  

<a href="https://youtube.com/@avilpage">
<img src="../../images/icons8-youtube.svg" alt="github-chillar-anand" height="34"></a>

  

<a href="https://linkedin.com/in/chillaranand">
<img src="../../images/icons8-linkedin.svg" alt="github-chillar-anand" height="34"></a>

  

<a href="https://twitter.com/chillaranand">
<img src="../../images/icons8-twitter.svg" alt="github-chillar-anand" height="34"></a>

</footer>
</div>

<br><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8127755709093749" crossorigin="anonymous"></script></footer>
</div>
    </div>
    </div>

                <script src="../../assets/js/jquery.min.js"></script><script src="../../assets/js/popper.min.js"></script><script src="../../assets/js/bootstrap.min.js"></script><script src="../../assets/js/baguetteBox.min.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
    </script>
</body>
</html>
