<!DOCTYPE html>
<html prefix="
og: http://ogp.me/ns#
article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="How to find performance bottlenecks in python web applications built with flask, django, asgi.">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Finding Performance Issues In Python Web Apps with Sentry | Avil Page</title>
<link href="../../assets/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/baguetteBox.min.css" rel="stylesheet" type="text/css">
<!-- <link href="/assets/css/rst_base.css" rel="stylesheet" type="text/css"> --><link href="../../assets/css/nikola_rst.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/theme.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/style.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/carbon.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">
<link rel="canonical" href="http://avilpage.com/2020/11/python-web-applications-performance-sentry.html">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Chillar Anand">
<link rel="prev" href="../10/python-docker-build-slim-fast.html" title="Make Python Docker Builds Slim &amp; Fast" type="text/html">
<link rel="next" href="../12/minimum-viable-testing-risk-based.html" title="Minimum Viable Testing - Get Maximum Stability With Minimum Effort" type="text/html">
<meta property="og:site_name" content="Avil Page">
<meta property="og:title" content="Finding Performance Issues In Python Web Apps with Sentry">
<meta property="og:url" content="http://avilpage.com/2020/11/python-web-applications-performance-sentry.html">
<meta property="og:description" content="How to find performance bottlenecks in python web applications built with flask, django, asgi.">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2020-11-30T23:59:54+05:30">
<meta property="article:tag" content="apm">
<meta property="article:tag" content="django">
<meta property="article:tag" content="python">
<meta property="article:tag" content="sentry">
<script data-ad-client="ca-pub-7483923329257191" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-fixed-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://avilpage.com/">

                <span id="blog-title">Avil Page</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="../../">Articles</a>
                </li>
<li>
<a href="../../p/talks.html">Talks</a>
                </li>
<li>
<a href="../../p/projects.html">Projects</a>
                </li>
<li>
<a href="../../p/pages.html">Pages</a>
                </li>
<li>
<a href="../../p/about.html">About</a>
                </li>
<li>
<a href="https://forms.gle/Hre4z4aLqJA5zYWe6">Contact</a>
                </li>
<li>
<a href="../../rss.xml">RSS</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<li>
            <a href="python-web-applications-performance-sentry.md" id="sourcelink">Source</a>
        </li>
                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content col-lg-6 col-lg-offset-3 col-xs-12 col-md-12">
        <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet">
<div class="">
            <div class="">
                <div class="avatar-module">
                    <img class="avatar" src="../../images/chillaranand.jpg">
</div>

                <p class="avatar-module">
                    <b>Chillar Anand</b>

                    <a href="https://twitter.com/chillaranand" class="btn btn-social-icon btn-twitter" target="_blank">
                        <span class="fa-stack fa-lg">
                            <i class="fa fa-square-o fa-stack-2x"></i>
                            <i class="fa fa-twitter fa-stack-1x"></i>
                        </span>
                    </a>

                    <a href="https://www.facebook.com/com.avilpage" class="btn btn-social-icon btn-facebook" target="_blank">
                        <span class="fa-stack fa-lg">
                            <i class="fa fa-square-o fa-stack-2x"></i>
                            <i class="fa fa-facebook-square fa-stack-1x"></i>
                        </span>
                    </a>

                    <a href="https://www.youtube.com/channel/UC6kIM3av9m_ljSKrMgd8Z_A" class="btn btn-social-icon btn-youtube" target="_blank">
                        <span class="fa-stack fa-lg">
                            <i class="fa fa-square-o fa-stack-2x"></i>
                            <i class="fa fa-youtube-square fa-stack-1x"></i>
                        </span>
                    </a>


                    <br>
                    Musings about programming, careers &amp; life.
                </p>
            </div>
        </div>

        <hr>
<!--Body content--><div class="row">
            
    <article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="#" class="u-url">Finding Performance Issues In Python Web Apps with Sentry</a></h1>

        <div class="metadata">
            <p class="dateline">
                <time class="published dt-published" datetime="2020-11-30T23:59:54+05:30" itemprop="datePublished" title="30 Nov 20">30 Nov 2020</time></p>
            |
            

        4 min read


        </div>
        
    </header><hr>
<div class="e-content entry-content" itemprop="articleBody text">
            <div>
<h4>Introduction</h4>
<p>Earlier, we have seen couple of articles here on finding performance issues<sup id="fnref:perf1"><a class="footnote-ref" href="python-web-applications-performance-sentry.html#fn:perf1">1</a></sup> and how to go about optimizing them<sup id="fnref:perf2"><a class="footnote-ref" href="python-web-applications-performance-sentry.html#fn:perf2">2</a></sup>. In this article, lets see how to use Sentry Performance to find bottlenecks in Python web applications.</p>
<h4>The Pitfalls</h4>
<p>A common pitfall while identifying performance issues is to do profiling in development environment. Performance in development environment will be quite different from production environment due to difference in system requirements, database size, network latency etc.</p>
<p>In some cases, performance issues could be happening only for certain users and in specific scenarios.</p>
<p>Replicating production performance on development machine will be costly. To avoid these, we can use APM tool to monitor performance in production.</p>
<h4>Sentry Performance</h4>
<p>Sentry is widely used Open source error tracking tool. Recently, it has introduced Performance to track performance also. Sentry doesn't need any agent running on the host machine to track performance. Enabling performance monitoring is just a single line change in Sentry<sup id="fnref:sentry"><a class="footnote-ref" href="python-web-applications-performance-sentry.html#fn:sentry">3</a></sup> setup.</p>
<pre class="code literal-block"><span></span><code><span class="kn">import</span> <span class="nn">sentry_sdk</span>


<span class="n">sentry_sdk</span><span class="o">.</span><span class="n">init</span><span class="p">(</span>
    <span class="n">dsn</span><span class="o">=</span><span class="s2">"dummy_dsn"</span><span class="p">,</span>
    <span class="c1"># Trace half the requests</span>
    <span class="n">traces_sample_rate</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
<span class="p">)</span>
</code></pre>

<p>Tracing performance will have additional overhead<sup id="fnref:oh"><a class="footnote-ref" href="python-web-applications-performance-sentry.html#fn:oh">4</a></sup> on the web application response time. Depending on the traffic, server capacity, acceptable overhead, we can decide what percentage of the requests we need to trace.</p>
<p>Once performance is enabled, we can head over to Sentry web application and see traces for the transactions along with operation breakdown as shown below.</p>
<p><img src="../../images/sentry0.png" style="vertical-align:middle"></p>
<p>At a glance, we can see percentage of time spent across each component which will pinpoint where the performance problem lies.</p>
<p>If the app server is taking most of the time, we can explore the spans in detail to pinpoint the exact line where it is taking most time. If database is taking most of the time, we can look out for the number of queries it is running and slowest queries to pinpoint the problem.</p>
<p>Sentry also provides option to set alerts when there are performance. For example, when the response time for a duration are less than a limit for a specified duration, Sentry can alert developers via email, slack or any other integration channels.</p>
<h4>Conclusion</h4>
<p>There are paid APM tools like New Relic, AppDynamics which requires an agent to be installed on the server. As mentioned in earlier articles, there are open source packages like django-silk to monitor performance. It will take time to set up these tools and pinpoint the issue.</p>
<p>Sentry is the only agentless APM tool<sup id="fnref:note"><a class="footnote-ref" href="python-web-applications-performance-sentry.html#fn:note">5</a></sup> available for Python applications. Setting up Sentry performance is quite easy and performance issues can be pinpointed without much hassle.</p>
<div class="footnote">
<hr>
<ol>
<li id="fn:perf1">
<p><a href="../../2018/12/django-bottleneck-performance-scaling.html">Finding High-impact Performance Bottlenecks</a> <a class="footnote-backref" href="python-web-applications-performance-sentry.html#fnref:perf1" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn:perf2">
<p><a href="../../2019/08/django-profile-optimize-views.html">Optimizing Bottlenecks In Django</a> <a class="footnote-backref" href="python-web-applications-performance-sentry.html#fnref:perf2" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
<li id="fn:sentry">
<p><a href="https://docs.sentry.io/platforms/python/performance/">Sentry - Performance Monitoring</a> <a class="footnote-backref" href="python-web-applications-performance-sentry.html#fnref:sentry" title="Jump back to footnote 3 in the text">↩</a></p>
</li>
<li id="fn:oh">
<p><a href="https://github.com/getsentry/sentry-python/issues/668#issuecomment-707768485">Sentry has 8% overhead in Django test suite</a> <a class="footnote-backref" href="python-web-applications-performance-sentry.html#fnref:oh" title="Jump back to footnote 4 in the text">↩</a></p>
</li>
<li id="fn:note">
<p>Earlier there was Opbeat APM which is now shutdown due to acquistion by Elastic. <a class="footnote-backref" href="python-web-applications-performance-sentry.html#fnref:note" title="Jump back to footnote 5 in the text">↩</a></p>
</li>
</ol>
</div>
</div>
        </div>
        <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../tags/apm.html" rel="tag">apm</a></li>
            <li><a class="tag p-category" href="../../tags/django.html" rel="tag">django</a></li>
            <li><a class="tag p-category" href="../../tags/python.html" rel="tag">python</a></li>
            <li><a class="tag p-category" href="../../tags/sentry.html" rel="tag">sentry</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../10/python-docker-build-slim-fast.html" rel="prev" title="Make Python Docker Builds Slim &amp; Fast">Previous post</a>
            </li>
            <li class="next">
                <a href="../12/minimum-viable-testing-risk-based.html" rel="next" title="Minimum Viable Testing - Get Maximum Stability With Minimum Effort">Next post</a>
            </li>
        </ul></nav></aside><!-- <div class="full-article-footer">
             <div class="article-footer">

             <div class="avatar-module">
             <img class="avatar" height="100px" src="/images/chillaranand.jpg">
             </div>

             <p class="avatar-module">
             Written by
             <br>
             <b>Chillar Anand</b>
             <br>
             Musings about programming, careers & life.
             </p>

             </div>
             </div> --><hr></article>
</div>
        <!--End of body content-->
        <div id="coral_thread"></div>

        <footer id="footer">
            Contents © 2021         <a href="mailto:">Chillar Anand</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
        </footer>
</div>
</div>

            <script src="../../assets/js/jquery.min.js"></script><script src="../../assets/js/bootstrap.min.js"></script><script src="../../assets/js/baguetteBox.min.js"></script><script src="../../assets/js/moment-with-locales.min.js"></script><script src="../../assets/js/fancydates.min.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
        }});
    </script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-81644162-1"></script><script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-81644162-1');

    $(document.links).filter(function() {
        return this.hostname != window.location.hostname;
    }).attr('target', '_blank');
    </script><!-- <script>
         (function() {
         var d = document, s = d.createElement('script');
         var url = 'avilpage-coral.herokuapp.com';
         /*         var url = 'http://comments.avilpage.com'; */
         s.src = '//' + url + '/assets/js/embed.js';
         s.async = false;
         s.defer = true;
         s.onload = function() {
         Coral.createStreamEmbed({
         id: "coral_thread",
         autoRender: true,
         rootURL: '//' + url,
         });
         };
         (d.head || d.body).appendChild(s);
         })();
         </script> -->
</body>
</html>
