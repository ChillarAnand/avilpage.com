<!DOCTYPE html>
<html prefix="
og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="How to find bottlenecks in django web application and scale it.">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Find High-impact Performance Bottlenecks in Django | Avil Page</title>
<link href="../../assets/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/baguetteBox.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/rst.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/theme.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../rss.xml">
<link rel="canonical" href="https://avilpage.com/2018/12/django-bottleneck-performance-scaling.html">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Chillar Anand">
<link rel="prev" href="../11/archive-millions-pages-wget-minutes.html" title="Archive Million Pages With wget In Minutes" type="text/html">
<link rel="next" href="../11/how-to-install-private-python-packages-with-pip.html" title="How To Install Private Python Packages With Pip" type="text/html">
<meta property="og:site_name" content="Avil Page">
<meta property="og:title" content="Find High-impact Performance Bottlenecks in Django">
<meta property="og:url" content="https://avilpage.com/2018/12/django-bottleneck-performance-scaling.html">
<meta property="og:description" content="How to find bottlenecks in django web application and scale it.">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2018-12-11T08:08:08+05:30">
<meta property="article:tag" content="django">
<meta property="article:tag" content="featured">
<meta property="article:tag" content="profiling">
<meta property="article:tag" content="python">
<style>
    .full-article-footer {
    border-top: 1px solid #E0DFDB;
}


.article-footer {
    padding: 20px 10px 10px 10px;
    min-height: 115px;
    display:table;
}


.avatar-module {
    display: table-cell;
    vertical-align: middle;
}


.avatar-module img {
    border-radius: 50%!important;
    height: 120px;
    width: 120px;
    float: left;
    margin:0px 20px 0px 20px;
}


.article-footer p {
    line-height:1.5em;
    padding-left:15px;
}


@media (max-width:750px) {
    .article-footer {
        display:inherit;
        margin:0px;
    }

    .avatar-module {
        display:inherit;
        vertical-align: none;
    }

    .avatar-module img {
        margin-left: auto;
        margin-right: auto;
        display: block;
        float:none;
        margin-top:0px;
    }

    .article-footer p {
        text-align:center;
        padding-left:0px;
    }
}

    </style>
<style>

 h1 {
     font-weight: bold;
     font-size: 25px;
 }

</style>
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

    <!-- Menubar -->
    <nav class="navbar navbar-expand-md static-top mb-4
                navbar-dark
                bg-dark
                "><div class="container">
<!-- This keeps the margins nice -->
            <a class="navbar-brand" href="../../">

                    <span id="blog-title">Avil Page</span>
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="bs-navbar">
                <ul class="navbar-nav mr-auto">
<li class="nav-item">
<a href="../../archive.html" class="nav-link">Blog</a>
                </li>
<li class="nav-item">
<a href="../../talks.html" class="nav-link">Talks</a>
                </li>
<li class="nav-item">
<a href="../../top-10.html" class="nav-link">Top 10</a>
                </li>
<li class="nav-item">
<a href="../../rss.xml" class="nav-link">RSS</a>

                    
                </li>
</ul>
<ul class="navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
        </div>
<!-- /.container -->
    </nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="row justify-content-md-center">
        <div class="body-content col col-lg-6">
            <!--Body content-->
            
    <article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="#" class="u-url">Find High-impact Performance Bottlenecks in Django</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card">
                <span class="byline-name fn p-name" itemprop="author">
                    Chillar Anand
                </span>
            </p>

            <p class="dateline">
                    8 min read
            </p>

            <p class="dateline">
                <a href="#" rel="bookmark">
                    <time class="published dt-published" datetime="2018-12-11T08:08:08+05:30" itemprop="datePublished" title="2018-12-11">2018-12-11</time></a>
            </p>
            
        </div>

        
    </header><div class="e-content entry-content" itemprop="articleBody text">
            <h4>Introduction</h4>
<p>When optimizing performance of web application, a common mistake is to start with optimizing the slowest page(or API). In addition to considering response time, we should also consider the traffic it is receving to priorotize the order of optimization.</p>
<p>In this article we will profile a django webapp, find high-impact performance bottlenecks and then start optimization them to yield better performance.</p>
<h4>Profiling</h4>
<p><a href="https://github.com/jazzband/django-silk">django-silk</a> is an open source profiling tool which intercepts and stores HTTP requests data. Install it with pip.</p>
<pre class="code literal-block">pip install django-silk
</pre>
<p>Add <code>silk</code> to installed apps and include silk middleware in django settings.</p>
<pre class="code literal-block"><span class="n">MIDDLEWARE</span> <span class="o">=</span> <span class="p">[</span>
    <span class="o">...</span>
    <span class="s1">'silk.middleware.SilkyMiddleware'</span><span class="p">,</span>
    <span class="o">...</span>
<span class="p">]</span>

<span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="o">...</span>
    <span class="s1">'silk'</span>
<span class="p">)</span>
</pre>
<p>Run migrations so that Silk can create required database tables to store profile data.</p>
<pre class="code literal-block">$ python manage.py makemigrations
$ python manage.py migrate
$ python manage.py collectstatic
</pre>
<p>Include silk urls in root urlconf to view the profile data.</p>
<pre class="code literal-block"><span class="n">urlpatterns</span> <span class="o">+=</span> <span class="p">[</span><span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">'^silk/'</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s1">'silk.urls'</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="s1">'silk'</span><span class="p">))]</span>
</pre>
<p>On silk requests page(<a href="#">http://host/silk/requests/</a>), we can see all requests and sort them by overall time or time spent in database.</p>
<p align="center">
<img src="../../images/django-bottlenecks.png"></p>

<h4>High Impact Bottlenecks</h4>
<p>Silk creates <code>silk_request</code> table which contains information about the requests processed by django.</p>
<pre class="code literal-block"><span class="err">$</span> <span class="n">pgcli</span>

<span class="n">library</span><span class="o">&gt;</span> <span class="err">\</span><span class="n">d</span> <span class="n">silk_request</span><span class="p">;</span>

<span class="o">+</span><span class="c1">--------------------+--------------------------+-------------+</span>
<span class="o">|</span> <span class="k">Column</span>             <span class="o">|</span> <span class="k">Type</span>                     <span class="o">|</span> <span class="n">Modifiers</span>   <span class="o">|</span>
<span class="o">|</span><span class="c1">--------------------+--------------------------+-------------|</span>
<span class="o">|</span> <span class="n">id</span>                 <span class="o">|</span> <span class="nb">character</span> <span class="nb">varying</span><span class="p">(</span><span class="mi">36</span><span class="p">)</span>    <span class="o">|</span>  <span class="k">not</span> <span class="k">null</span>   <span class="o">|</span>
<span class="o">|</span> <span class="n">path</span>               <span class="o">|</span> <span class="nb">character</span> <span class="nb">varying</span><span class="p">(</span><span class="mi">190</span><span class="p">)</span>   <span class="o">|</span>  <span class="k">not</span> <span class="k">null</span>   <span class="o">|</span>
<span class="o">|</span> <span class="n">time_taken</span>         <span class="o">|</span> <span class="n">double</span> <span class="k">precision</span>         <span class="o">|</span>  <span class="k">not</span> <span class="k">null</span>   <span class="o">|</span>
<span class="p">...</span>
</pre>
<p>We can group these requests data by <code>path</code>, calculate number of requests, average time taken and impact factor of each path. Since we are considering response time and traffic, impact factor will be product of average response time and number of requests for that path.</p>
<pre class="code literal-block"><span class="n">library</span><span class="o">&gt;</span> <span class="k">SELECT</span>
     <span class="n">s</span><span class="p">.</span><span class="o">*</span><span class="p">,</span> <span class="n">round</span><span class="p">((</span><span class="n">s</span><span class="p">.</span><span class="n">avg_time</span> <span class="o">*</span> <span class="n">s</span><span class="p">.</span><span class="k">count</span><span class="p">)</span><span class="o">/</span><span class="k">max</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">avg_time</span><span class="o">*</span><span class="n">s</span><span class="p">.</span><span class="k">count</span><span class="p">)</span> <span class="n">over</span> <span class="p">()::</span><span class="nb">NUMERIC</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">as</span> <span class="n">impact</span>
 <span class="k">FROM</span>
     <span class="p">(</span><span class="k">select</span> <span class="n">path</span><span class="p">,</span> <span class="n">round</span><span class="p">(</span><span class="k">avg</span><span class="p">(</span><span class="n">time_taken</span><span class="p">)::</span><span class="nb">numeric</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">as</span> <span class="n">avg_time</span><span class="p">,</span> <span class="k">count</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">as</span> <span class="k">count</span> <span class="k">from</span> <span class="n">silk_request</span> <span class="k">group</span> <span class="k">by</span> <span class="n">PATH</span><span class="p">)</span>
     <span class="n">s</span>
 <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">impact</span> <span class="k">DESC</span><span class="p">;</span>

<span class="o">+</span><span class="c1">-------------------------+------------+---------+----------+</span>
<span class="o">|</span> <span class="n">path</span>                    <span class="o">|</span> <span class="n">avg_time</span>   <span class="o">|</span> <span class="k">count</span>   <span class="o">|</span> <span class="n">impact</span>   <span class="o">|</span>
<span class="o">|</span><span class="c1">-------------------------+------------+---------+----------|</span>
<span class="o">|</span> <span class="o">/</span><span class="n">point</span><span class="o">/</span><span class="n">book</span><span class="o">/</span><span class="n">book</span><span class="o">/</span>       <span class="o">|</span> <span class="mi">239</span><span class="p">.</span><span class="mi">90</span>     <span class="o">|</span> <span class="mi">1400</span>    <span class="o">|</span> <span class="mi">1</span><span class="p">.</span><span class="mi">00</span>     <span class="o">|</span>
<span class="o">|</span> <span class="o">/</span><span class="n">point</span><span class="o">/</span><span class="n">book</span><span class="o">/</span><span class="k">data</span><span class="o">/</span>       <span class="o">|</span> <span class="mi">94</span><span class="p">.</span><span class="mi">81</span>      <span class="o">|</span> <span class="mi">1900</span>    <span class="o">|</span> <span class="mi">0</span><span class="p">.</span><span class="mi">54</span>     <span class="o">|</span>
<span class="o">|</span> <span class="o">/</span><span class="n">point</span><span class="o">/</span>                 <span class="o">|</span> <span class="mi">152</span><span class="p">.</span><span class="mi">49</span>     <span class="o">|</span> <span class="mi">900</span>     <span class="o">|</span> <span class="mi">0</span><span class="p">.</span><span class="mi">41</span>     <span class="o">|</span>
<span class="o">|</span> <span class="o">/</span><span class="n">point</span><span class="o">/</span><span class="n">login</span><span class="o">/</span>           <span class="o">|</span> <span class="mi">307</span><span class="p">.</span><span class="mi">03</span>     <span class="o">|</span> <span class="mi">400</span>     <span class="o">|</span> <span class="mi">0</span><span class="p">.</span><span class="mi">37</span>     <span class="o">|</span>
<span class="o">|</span> <span class="o">/</span>                       <span class="o">|</span> <span class="mi">106</span><span class="p">.</span><span class="mi">51</span>     <span class="o">|</span> <span class="mi">1000</span>    <span class="o">|</span> <span class="mi">0</span><span class="p">.</span><span class="mi">32</span>     <span class="o">|</span>
<span class="o">|</span> <span class="o">/</span><span class="n">point</span><span class="o">/</span><span class="n">auth</span><span class="o">/</span><span class="k">user</span><span class="o">/</span>       <span class="o">|</span> <span class="mi">494</span><span class="p">.</span><span class="mi">11</span>     <span class="o">|</span> <span class="mi">200</span>     <span class="o">|</span> <span class="mi">0</span><span class="p">.</span><span class="mi">29</span>     <span class="o">|</span>
<span class="p">...</span>
</pre>
<p>We can see <code>/point/book/book/</code> has highest impact even though it is neighter most visited nor slowest view. Optimizing this view first yields in overall better performance of webapp.</p>
<h4>Conclusion</h4>
<p>In this article, we learnt how to profile django webapp and identify bottlenecks to improve performance. In the next article, we wil learn how to optimize these bottlenecks by taking an in-depth look at them.</p>
        </div>
        <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../tags/django.html" rel="tag">django</a></li>
            <li><a class="tag p-category" href="../../tags/featured.html" rel="tag">featured</a></li>
            <li><a class="tag p-category" href="../../tags/profiling.html" rel="tag">profiling</a></li>
            <li><a class="tag p-category" href="../../tags/python.html" rel="tag">python</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../11/archive-millions-pages-wget-minutes.html" rel="prev" title="Archive Million Pages With wget In Minutes">Previous post</a>
            </li>
            <li class="next">
                <a href="../11/how-to-install-private-python-packages-with-pip.html" rel="next" title="How To Install Private Python Packages With Pip">Next post</a>
            </li>
        </ul></nav></aside><div class="full-article-footer">
            <div class="article-footer">

                <div class="avatar-module">
                    <img class="avatar" height="100px" src="../../images/chillaranand.jpg">
</div>

                <p class="avatar-module">
                    <b>Chillar Anand</b>
                    <br>
                    A blog about python, careers &amp; life.
                    <br>
                    To contact me, <a href="https://forms.gle/Hre4z4aLqJA5zYWe6">send a message here</a>.
                </p>

            </div>
        </div>

        
    </article><!--End of body content--><footer id="footer"><div class="container align-items-center justify-content-center d-flex">

<footer class="footer"><a href="https://github.com/ChillarAnand">
<img src="../../images/icons8-github.svg" alt="github-chillar-anand" height="34"></a>

  

<a href="https://stackoverflow.com/users/2698552/chillar-anand">
<img src="../../images/icons8-so.svg" alt="github-chillar-anand" height="30"></a>

  

<a href="https://youtube.com/@avilpage">
<img src="../../images/icons8-youtube.svg" alt="github-chillar-anand" height="34"></a>

  

<a href="https://linkedin.com/in/chillaranand">
<img src="../../images/icons8-linkedin.svg" alt="github-chillar-anand" height="34"></a>

  

<a href="https://twitter.com/chillaranand">
<img src="../../images/icons8-twitter.svg" alt="github-chillar-anand" height="34"></a>

</footer>
</div>

<br><br></footer>
</div>
    </div>
    </div>

                <script src="../../assets/js/jquery.min.js"></script><script src="../../assets/js/popper.min.js"></script><script src="../../assets/js/bootstrap.min.js"></script><script src="../../assets/js/baguetteBox.min.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
    </script>
</body>
</html>
