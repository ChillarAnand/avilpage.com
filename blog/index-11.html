<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="author" content="Chillar Anand">
<title>Avil Page (old posts, page 11) | Avil Page</title>
<link href="../assets/css/rst.css" rel="stylesheet" type="text/css">
<link href="../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../assets/css/theme.css" rel="stylesheet" type="text/css">
<link href="../assets/css/style.css" rel="stylesheet" type="text/css">
<link rel="canonical" href="http://www.avilpage.com/blog/index-11.html">
<!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
    <![endif]--><link rel="alternate" type="application/rss+xml" title="RSS" href="../rss.xml">
</head>
<body>
        <div id="">
            <div id="container">
                <!-- <h1 id="blog-title">
                     <a href="http://www.avilpage.com/" title="Avil Page" rel="home">Avil Page</a>
                     </h1> -->



        <article class="postbox h-entry post-text"><h1 class="p-name"><a href="../2017/01/refactoring-django-with-fst.html" class="u-url">Refactoring Django With Full Syntax Tree</a></h1>
        <hr>
<div class="e-content">
        <div>
<p>Django developers decided to <a href="https://code.djangoproject.com/ticket/23919" target="_blank">drop Python 2 compatability</a> in Django 2.0. There are serveral things that should be refactored/removed.</p>
<p>For example, in Python 2, programmers has to explicitly specify the class &amp; instance when invoking <code>super</code>.</p>
<pre class="code literal-block"><span></span><span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</pre>


<p>In Python 3, <code>super</code> can be invoked without arguments and it will choose right class &amp; instance automatically.</p>
<pre class="code literal-block"><span></span><span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</pre>


<p>For this refactoring, a simple <code>sed</code> search/replace should suffice. But, there are several hacks in codebase where super calls the grandparent instead of the parent. So, <code>sed</code> won't work in such cases. It is hard to refactor them manually and much harder for reviewers as there are 1364 super calls in code base.</p>
<pre class="code literal-block"><span></span>→ grep -rI <span class="s2">"super("</span> <span class="p">|</span> wc -l
   <span class="m">1364</span>
</pre>


<p>So changes has to be scripted. A <a href="https://github.com/ChillarAnand/01/blob/master/python/super_exp.py" target="_blank">simple python script</a> to replace super calls by class names will fail to capture classes with on top of them, classes with decorators and nested classes.</p>
<p>To handle all these cases, this python script gets more complicated and there is no guarantee that it can handle all edge cases. So, a better choice is to use syntax trees.</p>
<p>Python has <a href="https://docs.python.org/3/library/ast.html" target="_blank">ast module</a> to convert code to AST but it can't convert AST back to code. There are 3rd party packages like <a href="https://pypi.python.org/pypi/astor" target="_blank">astor</a> which can do this.</p>
<pre class="code literal-block"><span></span><span class="c1"># this is a comment</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>

   <span class="k">print</span><span class="p">(</span>
    <span class="s2">"hello world"</span>
<span class="p">)</span>
</pre>


<p>Converting above code to AST and then converting back gives this</p>
<pre class="code literal-block"><span></span><span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">'hello world'</span><span class="p">)</span>
</pre>


<p>Code to AST is a lossy transformation as they cannot preserve empty lines, comments and code formatting.</p>
<pre class="code literal-block"><span></span><span class="n">ast_to_code</span><span class="p">(</span><span class="n">code_to_ast</span><span class="p">(</span><span class="n">source_code</span><span class="p">))</span> <span class="o">!=</span> <span class="n">source_code</span>
</pre>


<p>For lossless transformation, FST(Full Syntax Trees) is needed.</p>
<pre class="code literal-block"><span></span><span class="n">fst_to_code</span><span class="p">(</span><span class="n">code_to_fst</span><span class="p">(</span><span class="n">source_code</span><span class="p">))</span> <span class="o">==</span> <span class="n">source_code</span>
</pre>


<p><a href="https://github.com/PyCQA/redbaron" target="_blank">RedBaron</a> package provides FST for given piece of code. With this, just locate super calls, find nearest class node, check class name with super and replace accordingly. With RedBaron, this refactoring can be done in <a href="https://github.com/ChillarAnand/01/blob/master/python/redbaron_super.py" target="_blank">less than 10 lines</a> of code.</p>
<p>RedBaron has good documentation with relveant examples and its API is similar to BeautifulSoup. To write code that modifies code RedBaron seems to be an apt choice.</p>
<p>Thanks to <a href="https://github.com/timgraham" target="_blank">Tim Graham</a> &amp; <a href="https://github.com/aaugustin" target="_blank">Aymeric Augustin</a> for <a href="https://github.com/django/django/pull/7905/commits/d6eaf7c0183cd04b78f2a55e1d60bb7e59598310" target="_blank">reviewing the patch</a>.</p>
</div>
        </div>
            
        </article><article class="postbox h-entry post-text"><h1 class="p-name"><a href="../2017/01/blog_posts_are_better_than_scientific_papers/" class="u-url">Why Blog Posts Are Better Than Scientific Papers?</a></h1>
        <hr>
<div class="e-content">
        <div>
<p>Titus Brown wrote a blog post on why <a href="http://ivory.idyll.org/blog/2017-top-ten-reasons-blog-posts.html">blog posts are better than scientific papers</a>. Here are few more reasons for that.</p>
<h3>Fast</h3>
<p>Publishing blog posts is lightning fast(how fast can you type?). You can just publish it with a click after writing. However with scientific papers you have to wait months to get your work published.</p>
<h3>Mutability</h3>
<p>Blog posts are easy to edit. If you are using a version controlled system like git, any one can easily collaborate. You can also leave comments on (most) blog posts and can have discussion with the author and/or others. Scientific papers once published are hard to change.</p>
<h3>No Gatekeepers</h3>
<p>To publish blog posts, you can setup your own blog or use services like <a href="http://medium.com">medium</a>. There are no gatekeepers who says that you can't publish a blog post because they thinks its not worth it.</p>
<h3>Organic</h3>
<p>Blog posts tend to be casual and organic. You can crack a joke and readers will enjoy it. Scientific papers are formal. You spray some sarcasm and your paper never gets published.</p>
</div>
        </div>
            
        </article><article class="postbox h-entry post-text"><h1 class="p-name"><a href="../2016/12/" class="u-url">What Is The Meaning Of Life?</a></h1>
        <hr>
<div class="e-content">
        <div>
<p>The meaning of life is</p>
<blockquote cite="https://en.oxforddictionaries.com/definition/life">

the condition that distinguishes animals and plants from inorganic matter, including the capacity for growth, reproduction, functional activity, and continual change preceding death.

</blockquote>

<p>Source: Oxford Dictionary</p>
</div>
        </div>
            
        </article><article class="postbox h-entry post-text"><h1 class="p-name"><a href="../2016/11/detect-correct-skew-images-python.html" class="u-url">Detect &amp; Correct Skew In Images Using Python</a></h1>
        <hr>
<div class="e-content">
        <div>
<p>When scanning a document, a slight skew gets into the scanned image. If you are using the scanned image to extract information from it, detecting and correcting skew is crucial.</p>
<p>There are several techniques that are used to skew correction.</p>
<ul>
<li>Projection profile method</li>
<li>
<p>Hough transform</p>
</li>
<li>
<p>Topline method</p>
</li>
<li>
<p>Scanline method</p>
</li>
</ul>
<p>However, projection profile method is the simplest and easiest way to determine skew in documents in the range ±5°. Lets take a part of scanned image and see how to correct skew.</p>
<p>In this method, we will convert image to black (absence of pixel) &amp; white (presence of pixel). Now image is projected vertically to get a histogram of pixels. Now image is rotated at various angles and above process is repeated. Wherver we find maximum diffrence between peaks, that will be the best angle.</p>
<pre class="code literal-block"><span></span><span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span> <span class="k">as</span> <span class="n">im</span>
<span class="kn">from</span> <span class="nn">scipy.ndimage</span> <span class="kn">import</span> <span class="n">interpolation</span> <span class="k">as</span> <span class="n">inter</span>

<span class="n">input_file</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">img</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span>

<span class="c1"># convert to binary</span>
<span class="n">wd</span><span class="p">,</span> <span class="n">ht</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">size</span>
<span class="n">pix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s1">'1'</span><span class="p">)</span><span class="o">.</span><span class="n">getdata</span><span class="p">(),</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
<span class="n">bin_img</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">pix</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">ht</span><span class="p">,</span> <span class="n">wd</span><span class="p">))</span> <span class="o">/</span> <span class="mf">255.0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">bin_img</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">'gray'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">'binary.png'</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">find_score</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">angle</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">inter</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">reshape</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">hist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">hist</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">hist</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">hist</span><span class="p">,</span> <span class="n">score</span>


<span class="n">delta</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">limit</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">limit</span><span class="p">,</span> <span class="n">limit</span><span class="o">+</span><span class="n">delta</span><span class="p">,</span> <span class="n">delta</span><span class="p">)</span>
<span class="n">scores</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">angle</span> <span class="ow">in</span> <span class="n">angles</span><span class="p">:</span>
    <span class="n">hist</span><span class="p">,</span> <span class="n">score</span> <span class="o">=</span> <span class="n">find_score</span><span class="p">(</span><span class="n">bin_img</span><span class="p">,</span> <span class="n">angle</span><span class="p">)</span>
    <span class="n">scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">score</span><span class="p">)</span>

<span class="n">best_score</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
<span class="n">best_angle</span> <span class="o">=</span> <span class="n">angles</span><span class="p">[</span><span class="n">scores</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">best_score</span><span class="p">)]</span>
<span class="k">print</span><span class="p">(</span><span class="s1">'Best angle: {}'</span><span class="o">.</span><span class="n">formate</span><span class="p">(</span><span class="n">best_angle</span><span class="p">))</span>

<span class="c1"># correct skew</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">inter</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">bin_img</span><span class="p">,</span> <span class="n">best_angle</span><span class="p">,</span> <span class="n">reshape</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">img</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">fromarray</span><span class="p">((</span><span class="mi">255</span> <span class="o">*</span> <span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">"uint8"</span><span class="p">))</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">"RGB"</span><span class="p">)</span>
<span class="n">img</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">'skew_corrected.png'</span><span class="p">)</span>
</pre>


<p><strong>Results:</strong></p>
<p align="center"><img align="center" src="../skew_python/original.png"></p>

<p align="center">Original Image</p>

<hr>
<p align="center"><img align="center" src="../skew_python/gray.png"></p>

<p align="center">Black &amp; white image</p>

<hr>
<p align="center"><img align="center" src="../skew_python/hist_0.png"></p>

<p align="center">Histogram of image</p>

<hr>
<p align="center"><img align="center" src="../skew_python/hist_scores.png"></p>

<p align="center">Scores at various angles</p>

<hr>
<p align="center"><img align="center" src="../skew_python/hist_best.png"></p>

<p align="center">Histogram at 2° (best angle)</p>

<hr>
<p align="center"><img align="center" src="../skew_python/skew_corrected.png"></p>

<p align="center">Skew corrected image</p>

<p>Here we have done only one iteration to find best angle. To get better accuracy, we can search over at (2 ± 0.5)°. This process can be repeated until we find a suitable level of accuracy.</p>
</div>
        </div>
            
        </article><article class="postbox h-entry post-text"><h1 class="p-name"><a href="../2016/10/why-use-cyanogenmod.html" class="u-url">Why I Use CyanogenMod?</a></h1>
        <hr>
<div class="e-content">
        <div>
<p>When listening to music, to switch tracks I want to use volume buttons. For this I have to use <a href="https://play.google.com/store/apps/details?id=com.silentlexx.volbtntrackctrl&amp;hl=en">Pocket Skip Track</a> app.
CyanogenMod has inbuilt support for that.</p>
<p>To interact with mobile from computer over wifi, <a href="https://play.google.com/store/apps/details?id=com.ttxapps.wifiadb">wifi adb</a> is required. CyanogenMod provides an option to enable this in <code>Developer Options</code>.</p>
<p>To put mobile in recovery mode, <a href="http://repo.xposed.info/module/com.ceco.kitkat.gravitybox">Gravity Box</a> is required. This should be used only after installing Xposed framework. CyanogenMod has <code>Advanced reboot</code> which provides option to put phone in recovery mode.</p>
<p>Battery icon in status bar is very small. Having a text percentage indicator will be more useful. For this <a href="https://play.google.com/store/apps/details?id=de.kroegerama.android4batpercent">battery percentage</a> is required.
CyanogenMod has inbuilt circle/text indicators.</p>
<p>Auto brighness stopped working after I have rooted Moto G4 plus. I had to use <a href="https://play.google.com/store/apps/details?id=com.urbandroid.lux">twilight</a> for auto brighness adjustment. With CyanogenMod, it is working fine. It also has a night mode option.</p>
<p>With stock android, auto rotate won't work in all directions. <a href="https://play.google.com/store/apps/details?id=com.googlecode.eyesfree.setorientation">Set orientation</a> app is required for that. CyanogenMod has inbuilt support for that.</p>
<p>To adapt mobile display to the time of the day, flux app is required on stock android. CyanogenMod has inbuilt option for this.</p>
<p>To get superuser permissions, I have to root stock android. CyanogenMod comes with root permissions. To run <code>adb</code> as root on stock android, <code>adbd insecure</code> app is required. CyanogenMod works without it.</p>
<p>Stock android also doesn't provide any options to customize status bar. CyanogenMod has several options to customize it.</p>
<p>There are several other things where CyanogenMod excels when compared to stock android like themes, privacy guard e.t.c. However, CyanogenMod comes with a lot of inbuilt features(batteries included) and that is the main reason for me to use it.</p>
</div>
        </div>
            
        </article><article class="postbox h-entry post-text"><h1 class="p-name"><a href="../2016/09/remove-clock-lock-screen-status-bar-android.html" class="u-url">Remove Clock From LockScreen/StatusBar On Android</a></h1>
        <hr>
<div class="e-content">
        <div>
<p>I have been living without time from a few years and it is a bliss. I have removed time from my laptop. For android mobile, I couldn't find a reliable way to remove time and I used to change timezone to a random zone. With Xposed framework we can remove clock from lock screen and status bar.</p>
<p>Before proceeding, make sure your phone is <a href="http://www.xda-developers.com/root/">rooted</a> and <a href="http://repo.xposed.info/module/de.robv.android.xposed.installer">Xposed framework</a> is installed.</p>
<h4>Remove Clock From LockScreen</h4>
<p>To remove clock from lockscreen, download <a href="http://repo.xposed.info/module/com.ssrdroide.lockscreenwidgets">Lock screen widgets</a> module and activate it.</p>
<p>If you open it, it has an option to hide date and time.</p>
<p align="center">
<img src="../remove_clock_android/remove_clock_anrdoid_0.png" height="400px" width="220"></p>

<h4>Remove Time From StatusBar</h4>
<p>To remove clock from status bar, you have to install <a href="http://repo.xposed.info/module/com.ceco.marshmallow.gravitybox">GravityBox</a>. Open GravityBox and goto statusbar settings</p>
<p align="center">
<img src="../remove_clock_android/remove_clock_anrdoid_3.png" height="400px" width="220"></p>

<p align="center">
<img src="../remove_clock_android/remove_clock_anrdoid_4.png" height="400px" width="220"></p>

<p align="center">
<img src="../remove_clock_android/remove_clock_anrdoid_5.png" height="400px" width="220"></p>

<p>If you are already using CyanogenMod, there is an option to hide time in settings.</p>
<p align="center">
<img src="../remove_clock_android/remove_clock_anrdoid_1.png" height="400px" width="220"></p>

<p align="center">
<img src="../remove_clock_android/remove_clock_anrdoid_2.png" height="400px" width="220"></p>

<p>Once you do this, you will have a neat lockscreen without any time on it.</p>
<p align="center">
<img src="../remove_clock_android/remove_clock_anrdoid_6.png" height="400px" width="220"></p>
</div>
        </div>
            
        </article><article class="postbox h-entry post-text"><h1 class="p-name"><a href="../2016/09/detecting-device-events-in-ubuntu-with-python.html" class="u-url">Detecting USB Events In Ubuntu With Python</a></h1>
        <hr>
<div class="e-content">
        <div>
<p><a href="https://en.wikipedia.org/wiki/Udev">udev</a> is responsible for managing devices on Linux. It provides <code>udevadm</code>, a CLI utility to monitor and control devices.</p>
<p>If we run <code>udevadm monitor</code> on terminal and connect a USB drive or hard disk or a mobile via USB to your computer, it will show that kernel has detected the device and it will send a signal to udev about it.</p>
<pre class="code literal-block"><span></span>→ udevadm monitor
monitor will print the received events <span class="k">for</span>:
UDEV - the event which udev sends out after rule processing
KERNEL - the kernel uevent

KERNEL<span class="o">[</span><span class="m">4336</span>.899091<span class="o">]</span> add      /devices/pci0000:00/0000:00:14.0/usb1/1-2 <span class="o">(</span>usb<span class="o">)</span>
KERNEL<span class="o">[</span><span class="m">4336</span>.899774<span class="o">]</span> add      /devices/pci0000:00/0000:00:14.0/usb1/1-2/1-2:1.0 <span class="o">(</span>usb<span class="o">)</span>
KERNEL<span class="o">[</span><span class="m">4336</span>.902553<span class="o">]</span> add      /devices/pci0000:00/0000:00:14.0/usb1/1-2/1-2:1.1 <span class="o">(</span>usb<span class="o">)</span>
UDEV  <span class="o">[</span><span class="m">4336</span>.911201<span class="o">]</span> add      /devices/pci0000:00/0000:00:14.0/usb1/1-2 <span class="o">(</span>usb<span class="o">)</span>
UDEV  <span class="o">[</span><span class="m">4336</span>.936453<span class="o">]</span> add      /devices/pci0000:00/0000:00:14.0/usb1/1-2/1-2:1.1 <span class="o">(</span>usb<span class="o">)</span>
UDEV  <span class="o">[</span><span class="m">4337</span>.947174<span class="o">]</span> add      /devices/pci0000:00/0000:00:14.0/usb1/1-2/1-2:1.0 <span class="o">(</span>usb<span class="o">)</span>
</pre>


<p><a href="https://pypi.python.org/pypi/pyudev">Pyudev</a>, a third party package provides python bindings for udev. It can be installed with <code>pip install pyudev</code>.</p>
<p>With this we can create a simple monitor to detect USB events.</p>
<pre class="code literal-block"><span></span><span class="kn">import</span> <span class="nn">pyudev</span>

<span class="n">context</span> <span class="o">=</span> <span class="n">pyudev</span><span class="o">.</span><span class="n">Context</span><span class="p">()</span>
<span class="n">monitor</span> <span class="o">=</span> <span class="n">pyudev</span><span class="o">.</span><span class="n">Monitor</span><span class="o">.</span><span class="n">from_netlink</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
<span class="n">monitor</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">subsystem</span><span class="o">=</span><span class="s1">'usb'</span><span class="p">)</span>

<span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="n">monitor</span><span class="o">.</span><span class="n">poll</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">device</span><span class="o">.</span><span class="n">action</span> <span class="o">==</span> <span class="s1">'add'</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">'{} connected'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">device</span><span class="p">))</span>
        <span class="c1"># do something</span>
</pre>


<p>Save this to a file say monitor.py and run it with <code>python monitor.py</code> and connect a mobile or pendrive and it will show something like this.</p>
<pre class="code literal-block"><span></span>Device<span class="o">(</span><span class="s1">'/sys/devices/pci0000:00/0000:00:14.0/usb1/1-6/1-6:1.0'</span><span class="o">)</span> connected
Device<span class="o">(</span><span class="s1">'/sys/devices/pci0000:00/0000:00:14.0/usb1/1-1/1-1:1.0'</span><span class="o">)</span> connected
</pre>


<p>Here we are just detecting <code>add</code> event. Similary we can detect other events like <code>delete</code>.</p>
<p>This is useful for automatically running shell scripts once the device gets plugged or unplugged.</p>
</div>
        </div>
            
        </article><article class="postbox h-entry post-text"><h1 class="p-name"><a href="../2016/08/migrate-from-blogger-to-static-site-nikola.html" class="u-url">Migrate From Blogger To Static Site (Nikola)</a></h1>
        <hr>
<div class="e-content">
        <div>
<p>Long back I have started this blog on <a href="https://blogger.com">blogger</a> platform. Now I choose to migrate to a static because of limitations of blogger.</p>
<p>Blogger has a simple editor in browser to write posts in html. With static site, you can write post in your editor in markdown and keep them in version control system like git.</p>
<p>Jekyll, Pelican, Lektor were my initial choices for static site generators. Unfortunately, they didn't had any useful plugins for smooth migration of data from blogger. Then I stumbled across <a href="https://plugins.getnikola.com/#import_blogger">import_blogger</a> plugin of <a href="https://getnikola.com">Nikola</a> and it is able to migrate text content, images without any issues. So, I decided to use Nikola.</p>
<p><a href="https://getnikola.com">Nikola</a> has great documentation and setup was simpler. I used <code>import_blogger</code> plugin and imported all the data. All the posts and pages were working well with exact same urls.</p>
<p>Blogger tags all posts of particular label under <code>/search/label/foo</code>. I have used these urls in some posts. Nikola shows posts under <code>/categories/foo.html</code>.</p>
<p>This is where nikola <code>REDIRECTIONS</code> come in handy. Using this, a list of from &amp; to urls can be mapped. I wrote a simple function for redirections and then enabled <code>STRIP_INDEXES</code> which removes trailing <code>.html</code>.</p>
<pre class="code literal-block"><span></span><span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'python'</span><span class="p">,</span> <span class="s1">'emacs'</span><span class="p">,</span> <span class="s1">'zen'</span><span class="p">,</span> <span class="s1">'django'</span><span class="p">,</span> <span class="s1">'chrome'</span><span class="p">]</span>
<span class="n">LABEL_REDIRECTIONS</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>
    <span class="n">LABEL_REDIRECTIONS</span><span class="o">.</span><span class="n">append</span><span class="p">((</span>
        <span class="s1">'/search/label/{}/index.html'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">),</span>
        <span class="s1">'/categories/{}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">),</span>
    <span class="p">))</span>
</pre>


<p>Since I stripped <code>.html</code> from urls, old urls broke. So I generated a list of old urls and wrote another function to redirect them to new urls.</p>
<p>Nikola has few builtin themes. I wanted something minimalistic and so I rolled out custom theme which you are seeing right now.</p>
<p>Thanks to <a href="https://github.com/punchagan">Puneeth Chaganti</a>, <a href="https://github.com/Kwpolska">Chris Warrick</a>, <a href="https://github.com/ralsina">Roberto Alsina</a> for helping me with migration.</p>
</div>
        </div>
            
        </article><article class="postbox h-entry post-text"><h1 class="p-name"><a href="../2016/07/emblem-mode-for-emacs.html" class="u-url">emblem-mode for Emacs</a></h1>
        <hr>
<div class="e-content">
        <div>
<p>Emblem.js is a ember friendly templating engine used as an alternative for handlebars.js.</p>
<p>Emblem.js doesn't have any official plugins for emacs. However they recommend to use slim plugins as they are similar.</p>
<p><code>slim-mode</code> is available on melpa. To install it, run</p>
<pre class="code literal-block"><span></span>M-x install-package slim-mode
</pre>


<p>After installing it, activate <code>slim-mode</code> by running <code>M-x slim-mode</code>.</p>
<p>Instead of activating manually, <code>auto-mode-alist</code> can be used to set major modes that needs to activated for files with specific extension. To activate slim-mode for emblem files which will be ending with <code>.em</code> or <code>.emblem</code>, use</p>
<pre class="code literal-block"><span></span><span class="p">(</span><span class="nv">add-to-list</span> <span class="ss">'auto-mode-alist</span> <span class="o">'</span><span class="p">(</span><span class="s">"\\.\\(em\\|emblem\\)"</span> <span class="o">.</span> <span class="nv">slim-mode</span><span class="p">))</span>
</pre>


<p>By adding this line to emacs configuration file, slim-mode gets activated for emblem.js files.</p>
</div>
        </div>
            
        </article><article class="postbox h-entry post-text"><h1 class="p-name"><a href="../2016/06/auto-completion-for-custom-search.html" class="u-url">Auto Completion For Custom Search Engines In Chrome</a></h1>
        <hr>
<div class="e-content">
        <div dir="ltr" style="text-align: left;" trbidi="on">
    <div dir="ltr" style="text-align: left;" trbidi="on">
      <span style="font-size: 16px; font-weight: normal; line-height: 25.6px;">If we have to search for a video on YouTube or a product on Amazon, we will open
      up that site first and then we will search for it.</span>
    </div>

    <div style="box-sizing: border-box; color: #333333; font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; font-size: 16px; line-height: 25.6px; margin-bottom: 16px;">
    <a href="https://cloud.githubusercontent.com/assets/4463796/15986478/89999bda-3026-11e6-9460-9b0c2d4db4d9.png" style="box-sizing: border-box; color: #4078c0; cursor: pointer; text-decoration: none;" target="_blank"><img alt="Chrome-custom-search-autocompletion1" src="https://cloud.githubusercontent.com/assets/4463796/15986478/89999bda-3026-11e6-9460-9b0c2d4db4d9.png" style="border: 0px; box-sizing: border-box; max-width: 100%;"></a>
    </div>

    <div style="box-sizing: border-box; color: #333333; font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; font-size: 16px; line-height: 25.6px; margin-bottom: 16px;">
    To avoid this, Chrome allows us to search using custom search engines without visiting the site first. In chrome search settings, we can assign a single
    letter to a custom search engine.
    </div>

    <div style="box-sizing: border-box; color: #333333; font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; font-size: 16px; line-height: 25.6px; margin-bottom: 16px;">
    <a href="https://cloud.githubusercontent.com/assets/4463796/15986479/899a642a-3026-11e6-8084-beddf28bf8d6.png" style="box-sizing: border-box; color: #4078c0; cursor: pointer; text-decoration: none;" target="_blank"><img alt="Chrome-custom-search-autocompletion1" src="https://cloud.githubusercontent.com/assets/4463796/15986479/899a642a-3026-11e6-8084-beddf28bf8d6.png" style="border: 0px; box-sizing: border-box; max-width: 100%;"></a>
    </div>

    <div style="box-sizing: border-box; color: #333333; font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; font-size: 16px; line-height: 25.6px; margin-bottom: 16px;">
    Now if we go to browser, type <code style="background-color: rgba(0, 0, 0, 0.0392157); border-radius: 3px; box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; margin: 0px; padding: 0.2em 0px;">y</code> and
    hit <code style="background-color: rgba(0, 0, 0, 0.0392157); border-radius: 3px; box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; margin: 0px; padding: 0.2em 0px;">Tab</code>,
    it prompts for YouTube search instead of default search.
    </div>

    <div style="box-sizing: border-box; color: #333333; font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; font-size: 16px; line-height: 25.6px; margin-bottom: 16px;">
    <a href="https://cloud.githubusercontent.com/assets/4463796/15986476/89951240-3026-11e6-99ad-cc8cf9127605.png" style="box-sizing: border-box; color: #4078c0; cursor: pointer; text-decoration: none;" target="_blank"><img alt="Chrome-custom-search-autocompletion1" src="https://cloud.githubusercontent.com/assets/4463796/15986476/89951240-3026-11e6-99ad-cc8cf9127605.png" style="border: 0px; box-sizing: border-box; max-width: 100%;"></a>
    </div>

    <div style="box-sizing: border-box; color: #333333; font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; font-size: 16px; line-height: 25.6px; margin-bottom: 16px;">
    This is handy. But the major problem with this approach is there won't be autocompletion in chrome address bar.
    </div>

    <div style="box-sizing: border-box; color: #333333; font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; font-size: 16px; line-height: 25.6px; margin-bottom: 16px;">
    This is where vimium comes into picture. Vimium provides auto completion for custom search engines.
    </div>

    <div style="box-sizing: border-box; color: #333333; font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; font-size: 16px; line-height: 25.6px; margin-bottom: 16px;">
    You can install it <a href="https://chrome.google.com/webstore/detail/dbepggeogbaibhgnhhndojpepiihcmeb" style="box-sizing: border-box; color: #4078c0; cursor: pointer; text-decoration: none;">from chrome webstore</a>. Once it is installed, go to Vimium options and
    add youtube search to custom search engines.
    </div>
    <pre style="background-color: #f7f7f7; border-radius: 3px; box-sizing: border-box; color: #333333; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; font-stretch: normal; line-height: 1.45; margin-bottom: 16px; overflow: auto; padding: 16px; word-wrap: normal;">

<code style="background: transparent; border-radius: 3px; border: 0px; box-sizing: border-box; display: inline; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; line-height: inherit; margin: 0px; max-width: initial; overflow: initial; padding: 0px; word-break: normal; word-wrap: normal;">y: http://www.youtube.com/results?search_query=%s Youtube<br></code>
</pre>

    <div style="box-sizing: border-box; color: #333333; font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; font-size: 16px; line-height: 25.6px; margin-bottom: 16px;">
    Also add a custom key map for this search.
    </div>
    <pre style="background-color: #f7f7f7; border-radius: 3px; box-sizing: border-box; color: #333333; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; font-stretch: normal; line-height: 1.45; margin-bottom: 16px; overflow: auto; padding: 16px; word-wrap: normal;">

<code style="background: transparent; border-radius: 3px; border: 0px; box-sizing: border-box; display: inline; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; line-height: inherit; margin: 0px; max-width: initial; overflow: initial; padding: 0px; word-break: normal; word-wrap: normal;">map y Vomnibar.activateInNewTab keyword=y<br></code>
</pre>

    <div style="box-sizing: border-box; color: #333333; font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; font-size: 16px; line-height: 25.6px; margin-bottom: 16px;">
    If we just press <code style="background-color: rgba(0, 0, 0, 0.0392157); border-radius: 3px; box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 13.6px; margin: 0px; padding: 0.2em 0px;">y</code>,
    it open youtube custom search with autocompletion.
    </div>

    <div style="box-sizing: border-box; color: #333333; font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; font-size: 16px; line-height: 25.6px; margin-bottom: 16px;">
    <a href="https://cloud.githubusercontent.com/assets/4463796/15986477/8996f3e4-3026-11e6-8c83-8a74f0ab84fb.png" style="box-sizing: border-box; color: #4078c0; cursor: pointer; text-decoration: none;" target="_blank"><img alt="Chrome-custom-search-autocompletion1" src="https://cloud.githubusercontent.com/assets/4463796/15986477/8996f3e4-3026-11e6-8c83-8a74f0ab84fb.png" style="border: 0px; box-sizing: border-box; max-width: 100%;"></a>
    </div>

    <div style="box-sizing: border-box; color: #333333; font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; font-size: 16px; line-height: 25.6px; margin-bottom: 16px;">
        Now in every page, we have autocompletion for custom search engines.<br><br>
      More articles about <a href="../search/label/chrome/">Chrome</a>.

    </div>
  </div>

        </div>
            
        </article><nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-12.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-10.html" rel="next">Older posts</a>
            </li>
        </ul></nav><br>
</div>


            <!--Sidebar content-->
            <!-- <ul class="unstyled">
                     

                                 <li><a href="/">Articles</a>
                <li><a href="/about">About.html</a>
                <li><a href="/rss.xml">RSS</a>

                 </ul> -->
            <br>
</div>
    </body>
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                             m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-81644162-1', 'auto');
    ga('send', 'pageview');

    </script>
</html>
