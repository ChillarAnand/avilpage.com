<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="../assets/xml/rss.xsl" media="all"?><rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Avil Page (Posts about macbook)</title><link>https://avilpage.com/</link><description></description><atom:link href="https://avilpage.com/tags/macbook.xml" rel="self" type="application/rss+xml"></atom:link><language>en</language><lastBuildDate>Sun, 23 Oct 2022 08:12:49 GMT</lastBuildDate><generator>Nikola (getnikola.com)</generator><docs>http://blogs.law.harvard.edu/tech/rss</docs><item><title>Speed Up AMD64(Intel) VMs on ARM(M1 Mac) Host</title><link>https://avilpage.com/2022/10/speedup-amd64-containers-on-arm.html</link><dc:creator>Chillar Anand</dc:creator><description>&lt;h4&gt;Introduction&lt;/h4&gt;
&lt;p&gt;From 2020, Apple has transitioned from Intel to ARM based Apple Silicon M1. If we run &lt;code&gt;uname -mp&lt;/code&gt; on these devices, we can see the CPU architecture details.&lt;/p&gt;
&lt;div class="code"&gt;&lt;pre class="code literal-block"&gt;$ uname -mp
arm64 arm
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Let's run the same command on a device using Intel x86 processor.&lt;/p&gt;
&lt;div class="code"&gt;&lt;pre class="code literal-block"&gt;$ uname -mp
x86_64 x86_64
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Many popular docker images&lt;sup id="fnref:dhub"&gt;&lt;a class="footnote-ref" href="https://avilpage.com/2022/10/speedup-amd64-containers-on-arm.html#fn:dhub"&gt;1&lt;/a&gt;&lt;/sup&gt; doesn't have ARM64 support yet. When setting up a dev environment in M1 Mac, there are high chances that we stumble on these containers if we are using plain docker or ARM64 VM. So, there is a need to spin up x86_64 VMs.&lt;/p&gt;
&lt;p&gt;In this article, lets see how the performance affects when running a cross architecture containers and how to speed it up.&lt;/p&gt;
&lt;h4&gt;Setup&lt;/h4&gt;
&lt;p&gt;Lima&lt;sup id="fnref:lima"&gt;&lt;a class="footnote-ref" href="https://avilpage.com/2022/10/speedup-amd64-containers-on-arm.html#fn:lima"&gt;2&lt;/a&gt;&lt;/sup&gt; can run foreign architecture(x6_64) VMs on Mac. Let's install lima, start a AMD64 VM &amp;amp; ARM64 VM and install k3s&lt;sup id="fnref:k3s"&gt;&lt;a class="footnote-ref" href="https://avilpage.com/2022/10/speedup-amd64-containers-on-arm.html#fn:k3s"&gt;3&lt;/a&gt;&lt;/sup&gt; in them. k3s will run multiple process in the background and let's see how resource consumption varies in these VMs.&lt;/p&gt;
&lt;div class="code"&gt;&lt;pre class="code literal-block"&gt;$ brew install lima

$ limactl start linux_arm64
$ limactl start linux_amd64
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;When starting a VM, we can edit &lt;code&gt;arch&lt;/code&gt; parameter in the configuration. Once VM starts, we can see the details by running &lt;code&gt;limactl list&lt;/code&gt;.&lt;/p&gt;
&lt;div class="code"&gt;&lt;pre class="code literal-block"&gt;$ limactl list
NAME                ARCH
linux_amd64         x86_64
linux_arm64         aarch64
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Lets login to each VM &amp;amp; install k3s.&lt;/p&gt;
&lt;div class="code"&gt;&lt;pre class="code literal-block"&gt;$ limactl shell linux_arm64

$ curl -sfL https://get.k3s.io &lt;span class="p"&gt;|&lt;/span&gt; sh -
&lt;/pre&gt;&lt;/div&gt;

&lt;div class="code"&gt;&lt;pre class="code literal-block"&gt;$ limactl shell linux_amd64

$ curl -sfL https://get.k3s.io &lt;span class="p"&gt;|&lt;/span&gt; sh -
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;If we look at resource consumption on the host machine, x86_84 VM is using way more resources than ARM64 VM. This is because of the emulation layer that is running on top of the VM.&lt;/p&gt;
&lt;p align="center"&gt;
&lt;img src="https://avilpage.com/images/arch-arm-docker.png"&gt;
&lt;/p&gt;

&lt;p&gt;We can login to individual VMs, run &lt;code&gt;top&lt;/code&gt; to see the load average as well.&lt;/p&gt;
&lt;h4&gt;Fast Mode&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;lima&lt;/code&gt; provides &lt;code&gt;fast-mode&lt;/code&gt; option for cross architecture VMs which will speed up the performance.&lt;/p&gt;
&lt;p&gt;For that, we need to log in to VMs and install emulators.&lt;/p&gt;
&lt;div class="code"&gt;&lt;pre class="code literal-block"&gt;$ sudo systemctl start containerd
$ sudo nerdctl run --privileged --rm tonistiigi/binfmt --install all
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;After that we can restart the VMs and monitor the resource consumption. On an average, we can see that the resource consumption is reduced by 50%.&lt;/p&gt;
&lt;h4&gt;Conclusion&lt;/h4&gt;
&lt;p&gt;In this article, we saw how to run cross architecture VMs on M1 Mac and how to speed up the performance. We can use this technique to run cross architecture containers on Linux as well.&lt;/p&gt;
&lt;div class="footnote"&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id="fn:dhub"&gt;
&lt;p&gt;&lt;a href="https://hub.docker.com/search?q=&amp;amp;page=10"&gt;https://hub.docker.com/search?q=&amp;amp;page=10&lt;/a&gt; &lt;a class="footnote-backref" href="https://avilpage.com/2022/10/speedup-amd64-containers-on-arm.html#fnref:dhub" title="Jump back to footnote 1 in the text"&gt;↩&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn:lima"&gt;
&lt;p&gt;&lt;a href="https://github.com/lima-vm/lima"&gt;https://github.com/lima-vm/lima&lt;/a&gt; &lt;a class="footnote-backref" href="https://avilpage.com/2022/10/speedup-amd64-containers-on-arm.html#fnref:lima" title="Jump back to footnote 2 in the text"&gt;↩&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id="fn:k3s"&gt;
&lt;p&gt;&lt;a href="https://avilpage.com/2022/10/local-kubernetes-with-k3s-on-mac.html"&gt;Install k3s on Mac M1&lt;/a&gt; &lt;a class="footnote-backref" href="https://avilpage.com/2022/10/speedup-amd64-containers-on-arm.html#fnref:k3s" title="Jump back to footnote 3 in the text"&gt;↩&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;</description><category>devops</category><category>linux</category><category>macbook</category><guid>https://avilpage.com/2022/10/speedup-amd64-containers-on-arm.html</guid><pubDate>Thu, 20 Oct 2022 17:08:56 GMT</pubDate></item><item><title>Lesser Know Useful Utilities For MacBook</title><link>https://avilpage.com/2021/06/lesser-know-useful-utilities-for-mac.html</link><dc:creator>Chillar Anand</dc:creator><description>&lt;h4&gt;Introduction&lt;/h4&gt;
&lt;p&gt;When using Mac, there are few utilities which come in handy for day to day operations and also aid in productivity.&lt;/p&gt;
&lt;p&gt;Here are some of the useful but lesser know utilities for mac.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;h4&gt;iGlance&lt;/h4&gt;
&lt;p align="center"&gt;
&lt;img height="400" width="800" src="https://avilpage.com/images/iglance.png"&gt;
&lt;/p&gt;

&lt;p&gt;&lt;a href="https://github.com/iglance/iGlance"&gt;iGlance&lt;/a&gt; is a system monitor tool that shows all the stats right from the menu bar itself.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;h4&gt;Debokee Tools&lt;/h4&gt;
&lt;p align="center"&gt;
&lt;img src="https://avilpage.com/images/debokee.png"&gt;
&lt;/p&gt;

&lt;p&gt;Wondering which network your Mac connected to? If you use multiple wireless networks, then &lt;a href="https://apps.apple.com/us/app/debookee-tools/id1110355801?mt=12"&gt;Debokee Tools&lt;/a&gt; can show the connected wireless network name directly in the menu bar.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;h4&gt;Espanso&lt;/h4&gt;
&lt;p align="center"&gt;
&lt;img src="https://avilpage.com/images/espanso.gif"&gt;
&lt;/p&gt;

&lt;p&gt;&lt;a href="https://github.com/federico-terzi/espanso"&gt;Espanso&lt;/a&gt; is a text expanding tool that improves productivity across the system. We can set up shortcuts for frequently typed things like email, phone number etc so that we don't have to type them again and again.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;h4&gt;Karabiner-Elements&lt;/h4&gt;
&lt;p&gt;&lt;a href="https://karabiner-elements.pqrs.org/"&gt;Karabiner Elements&lt;/a&gt; allows users to customize keyboard via simple modifications, complex modifications, function key modifications etc.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;h4&gt;Flycut&lt;/h4&gt;
&lt;p&gt;&lt;a href="https://github.com/TermiT/Flycut"&gt;Flycut&lt;/a&gt; is a simple clipboard manager, stores history. When you want to copy/paste frequently, this comes in handy.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;h4&gt;CheatSheet&lt;/h4&gt;
&lt;p align="center"&gt;
&lt;img src="https://avilpage.com/images/cheatsheet.png"&gt;
&lt;/p&gt;

&lt;p&gt;Ever wondered what are the keybindings when using any application? With &lt;a href="https://www.mediaatelier.com/CheatSheet/"&gt;CheatSheet&lt;/a&gt;, we can just hold &lt;code&gt;⌘&lt;/code&gt; key bit longer, and it will show all the available shortcuts in the application.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;h4&gt;Bandwidth+&lt;/h4&gt;
&lt;p align="center"&gt;
&lt;img src="https://avilpage.com/images/bandwidth.png"&gt;
&lt;/p&gt;

&lt;p&gt;&lt;a href="https://apps.apple.com/us/app/bandwidth/id490461369?mt=12"&gt;Bandwidth+&lt;/a&gt; tracks network usage on Mac. If there are multiple networks, it gives detailed information about the network consumed on all the networks.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;h4&gt;Grand Perspective&lt;/h4&gt;
&lt;p align="center"&gt;
&lt;img src="https://avilpage.com/images/grand_perspective.jpg"&gt;
&lt;/p&gt;

&lt;p&gt;If Mac is running low on disk space, &lt;a href="https://apps.apple.com/us/app/grandperspective/id1111570163?mt=12"&gt;Grand Perspective&lt;/a&gt; shows a graphical view of the disk usage. It will be much easier to pinpoint large files that are consuming the disk and then clean them up.&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;h4&gt;Conclusion&lt;/h4&gt;
&lt;p&gt;These are some useful utilities for day to day usage. In the upcoming articles, lets learn about useful command line utilities that improve productivity on a daily basis.&lt;/p&gt;</description><category>macbook</category><guid>https://avilpage.com/2021/06/lesser-know-useful-utilities-for-mac.html</guid><pubDate>Fri, 11 Jun 2021 01:30:00 GMT</pubDate></item></channel></rss>