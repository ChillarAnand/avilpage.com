<!DOCTYPE html>
<html prefix="
og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="How to verify certificate chain with openssl on the command line in linux or mac?">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Verifying TLS Certificate Chain With OpenSSL | Avil Page</title>
<link href="../../assets/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/baguetteBox.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/rst.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/theme.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../rss.xml">
<link rel="canonical" href="https://avilpage.com/2019/11/verify-tls-certificate-chain-with-openssl.html">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Chillar Anand">
<link rel="prev" href="../10/writing-editing-code-with-code.html" title="Writing &amp; Editing Code With Code - Part 1" type="text/html">
<link rel="next" href="../12/mastering-dicom-part-1.html" title="Mastering DICOM - #1 Clinical Workflows 101" type="text/html">
<meta property="og:site_name" content="Avil Page">
<meta property="og:title" content="Verifying TLS Certificate Chain With OpenSSL">
<meta property="og:url" content="https://avilpage.com/2019/11/verify-tls-certificate-chain-with-openssl.html">
<meta property="og:description" content="How to verify certificate chain with openssl on the command line in linux or mac?">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2019-11-30T10:15:14+05:30">
<meta property="article:tag" content="command-line">
<style>
    .full-article-footer {
    border-top: 1px solid #E0DFDB;
}


.article-footer {
    padding: 20px 10px 10px 10px;
    min-height: 115px;
    display:table;
}


.avatar-module {
    display: table-cell;
    vertical-align: middle;
}


.avatar-module img {
    border-radius: 50%!important;
    height: 120px;
    width: 120px;
    float: left;
    margin:0px 20px 0px 20px;
}


.article-footer p {
    line-height:1.5em;
    padding-left:15px;
}


@media (max-width:750px) {
    .article-footer {
        display:inherit;
        margin:0px;
    }

    .avatar-module {
        display:inherit;
        vertical-align: none;
    }

    .avatar-module img {
        margin-left: auto;
        margin-right: auto;
        display: block;
        float:none;
        margin-top:0px;
    }

    .article-footer p {
        text-align:center;
        padding-left:0px;
    }
}

    </style>
<style>

 h1 {
     font-weight: bold;
     font-size: 25px;
 }

</style>
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

    <!-- Menubar -->
    <nav class="navbar navbar-expand-md static-top mb-4
                navbar-dark
                bg-dark
                "><div class="container">
<!-- This keeps the margins nice -->
            <a class="navbar-brand" href="../../">

                    <span id="blog-title">Avil Page</span>
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="bs-navbar">
                <ul class="navbar-nav mr-auto">
<li class="nav-item">
<a href="../../archive.html" class="nav-link">Archive</a>
                </li>
<li class="nav-item">
<a href="../../top-10.html" class="nav-link">Top 10</a>
                </li>
<li class="nav-item">
<a href="../../rss.xml" class="nav-link">RSS</a>

                    
                </li>
</ul>
<ul class="navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
        </div>
<!-- /.container -->
    </nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="row justify-content-md-center">
        <div class="body-content col col-lg-6">
            <!--Body content-->
            
    <article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="#" class="u-url">Verifying TLS Certificate Chain With OpenSSL</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card">
                <span class="byline-name fn p-name" itemprop="author">
                    Chillar Anand
                </span>
            </p>

            <p class="dateline">
                    8 min read
            </p>

            <p class="dateline">
                <a href="#" rel="bookmark">
                    <time class="published dt-published" datetime="2019-11-30T10:15:14+05:30" itemprop="datePublished" title="2019-11-30">2019-11-30</time></a>
            </p>
            
        </div>

        
    </header><div class="e-content entry-content" itemprop="articleBody text">
            <h4>Introduction</h4>
<p>To communicate securely over the internet, HTTPS (HTTP over TLS) is used. A key component of HTTPS is Certificate authority (CA), which by issuing digital certificates acts as a trusted 3rd party between server(eg: google.com) and others(eg: mobiles, laptops).</p>
<p>In this article, we will learn how to obtain certificates from a server and manually verify them on a laptop to establish a chain of trust.</p>
<h4>Chain of Trust</h4>
<p>TLS certificate chain typically consists of server certificate which is signed by intermediate certificate of CA which is inturn signed with CA root certificate.</p>
<p>Using OpenSSL, we can gather the server and intermediate certificates sent by a server using the following command.</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>openssl<span class="w"> </span>s_client<span class="w"> </span>-showcerts<span class="w"> </span>-connect<span class="w"> </span>avilpage.com:443

CONNECTED<span class="o">(</span><span class="m">00000006</span><span class="o">)</span>
<span class="nv">depth</span><span class="o">=</span><span class="m">2</span><span class="w"> </span><span class="nv">C</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>US,<span class="w"> </span><span class="nv">O</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>DigiCert<span class="w"> </span>Inc,<span class="w"> </span><span class="nv">OU</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>www.digicert.com,<span class="w"> </span><span class="nv">CN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>DigiCert<span class="w"> </span>High<span class="w"> </span>Assurance<span class="w"> </span>EV<span class="w"> </span>Root<span class="w"> </span>CA
verify<span class="w"> </span><span class="k">return</span>:1
<span class="nv">depth</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="nv">C</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>US,<span class="w"> </span><span class="nv">O</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>DigiCert<span class="w"> </span>Inc,<span class="w"> </span><span class="nv">OU</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>www.digicert.com,<span class="w"> </span><span class="nv">CN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>DigiCert<span class="w"> </span>SHA2<span class="w"> </span>High<span class="w"> </span>Assurance<span class="w"> </span>Server<span class="w"> </span>CA
verify<span class="w"> </span><span class="k">return</span>:1
<span class="nv">depth</span><span class="o">=</span><span class="m">0</span><span class="w"> </span><span class="nv">C</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>US,<span class="w"> </span><span class="nv">ST</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>California,<span class="w"> </span><span class="nv">L</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>San<span class="w"> </span>Francisco,<span class="w"> </span><span class="nv">O</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"GitHub, Inc."</span>,<span class="w"> </span><span class="nv">CN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>www.github.com
verify<span class="w"> </span><span class="k">return</span>:1
---
Certificate<span class="w"> </span>chain
<span class="w"> </span><span class="m">0</span><span class="w"> </span>s:/C<span class="o">=</span>US/ST<span class="o">=</span>California/L<span class="o">=</span>San<span class="w"> </span>Francisco/O<span class="o">=</span>GitHub,<span class="w"> </span>Inc./CN<span class="o">=</span>www.github.com
<span class="w">   </span>i:/C<span class="o">=</span>US/O<span class="o">=</span>DigiCert<span class="w"> </span>Inc/OU<span class="o">=</span>www.digicert.com/CN<span class="o">=</span>DigiCert<span class="w"> </span>SHA2<span class="w"> </span>High<span class="w"> </span>Assurance<span class="w"> </span>Server<span class="w"> </span>CA
-----BEGIN<span class="w"> </span>CERTIFICATE-----
MIIHMTCCBhmgAwIBAgIQDf56dauo4GsS0tOc8
MQswCQYDVQQGEwJVUzEVMBMGA1UEChMMRGlna
0wGjIChBWUMo0oHjqvbsezt3tkBigAVBRQHvF
aTrrJ67dru040my
-----END<span class="w"> </span>CERTIFICATE-----
<span class="w"> </span><span class="m">1</span><span class="w"> </span>s:/C<span class="o">=</span>US/O<span class="o">=</span>DigiCert<span class="w"> </span>Inc/OU<span class="o">=</span>www.digicert.com/CN<span class="o">=</span>DigiCert<span class="w"> </span>SHA2<span class="w"> </span>High<span class="w"> </span>Assurance<span class="w"> </span>Server<span class="w"> </span>CA
<span class="w">   </span>i:/C<span class="o">=</span>US/O<span class="o">=</span>DigiCert<span class="w"> </span>Inc/OU<span class="o">=</span>www.digicert.com/CN<span class="o">=</span>DigiCert<span class="w"> </span>High<span class="w"> </span>Assurance<span class="w"> </span>EV<span class="w"> </span>Root<span class="w"> </span>CA
-----BEGIN<span class="w"> </span>CERTIFICATE-----
MIIEsTCCA5mgAwIBAgIQBOHnpNxc8vNtwCtC
MQswCQYDVQQGEwJVUzEVMBMGA1UEChMMRGln
0wGjIChBWUMo0oHjqvbsezt3tkBigAVBRQHv
<span class="nv">cPUeybQ</span><span class="o">=</span>
-----END<span class="w"> </span>CERTIFICATE-----

<span class="w">    </span>Verify<span class="w"> </span><span class="k">return</span><span class="w"> </span>code:<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">(</span>ok<span class="o">)</span>
</pre></div>

<p>This command internally verfies if the certificate chain is valid. The output contains the server certificate and the intermediate certificate along with their issuer and subject. Copy both the certificates into <code>server.pem</code> and <code>intermediate.pem</code> files.</p>
<p>We can decode these pem files and see the information in these certificates using</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>openssl<span class="w"> </span>x509<span class="w"> </span>-noout<span class="w"> </span>-text<span class="w"> </span>-in<span class="w"> </span>server.crt

Certificate:
<span class="w">    </span>Data:
<span class="w">        </span>Version:<span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="o">(</span>0x2<span class="o">)</span>
<span class="w">    </span>Signature<span class="w"> </span>Algorithm:<span class="w"> </span>sha256WithRSAEncryption
<span class="w">    </span>----
</pre></div>

<p>We can also get only the subject and issuer of the certificate with</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>openssl<span class="w"> </span>x509<span class="w"> </span>-noout<span class="w"> </span>-subject<span class="w"> </span>-noout<span class="w"> </span>-issuer<span class="w"> </span>-in<span class="w"> </span>server.pem

<span class="nv">subject</span><span class="o">=</span><span class="w"> </span><span class="nv">CN</span><span class="o">=</span>www.github.com
<span class="nv">issuer</span><span class="o">=</span><span class="w"> </span><span class="nv">CN</span><span class="o">=</span>DigiCert<span class="w"> </span>SHA2<span class="w"> </span>High<span class="w"> </span>Assurance<span class="w"> </span>Server<span class="w"> </span>CA

$<span class="w"> </span>openssl<span class="w"> </span>x509<span class="w"> </span>-noout<span class="w"> </span>-subject<span class="w"> </span>-noout<span class="w"> </span>-issuer<span class="w"> </span>-in<span class="w"> </span>intermediate.pem

<span class="nv">subject</span><span class="o">=</span><span class="w"> </span><span class="nv">CN</span><span class="o">=</span>DigiCert<span class="w"> </span>SHA2<span class="w"> </span>High<span class="w"> </span>Assurance<span class="w"> </span>Server<span class="w"> </span>CA
<span class="nv">issuer</span><span class="o">=</span><span class="w"> </span><span class="nv">CN</span><span class="o">=</span>DigiCert<span class="w"> </span>High<span class="w"> </span>Assurance<span class="w"> </span>EV<span class="w"> </span>Root<span class="w"> </span>CA
</pre></div>

<p>Now that we have both server and intermediate certificates at hand, we need to look for the relevant root certificate (in this case DigiCert High Assurance EV Root CA) in our system to verify these.</p>
<p>If you are using a Linux machine, all the root certificate will readily available in <code>.pem</code> format in <code>/etc/ssl/certs</code> directory.</p>
<p>If you are using a Mac, open <code>Keychain Access</code>, search and export the relevant root certificate in <code>.pem</code> format.</p>
<p algin="center">
<img src="../../images/tls-openssl1.png"></p>

<p>We have all the 3 certificates in the chain of trust and we can validate them with</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>openssl<span class="w"> </span>verify<span class="w"> </span>-verbose<span class="w"> </span>-CAfile<span class="w"> </span>root.pem<span class="w"> </span>-untrusted<span class="w"> </span>intermediate.pem<span class="w"> </span>server.pem
server.pem:<span class="w"> </span>OK
</pre></div>

<p>If there is some issue with validation OpenSSL will throw an error with relevant information.</p>
<h4>Conclusion</h4>
<p>In this article, we learnt how to get certificates from the server and validate them with the root certificate using OpenSSL.</p>
        </div>
        <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../tags/command-line.html" rel="tag">command-line</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../10/writing-editing-code-with-code.html" rel="prev" title="Writing &amp; Editing Code With Code - Part 1">Previous post</a>
            </li>
            <li class="next">
                <a href="../12/mastering-dicom-part-1.html" rel="next" title="Mastering DICOM - #1 Clinical Workflows 101">Next post</a>
            </li>
        </ul></nav></aside><div class="full-article-footer">
            <div class="article-footer">

                <div class="avatar-module">
                    <img class="avatar" height="100px" src="../../images/chillaranand.jpg">
</div>

                <p class="avatar-module">
                    <b>Chillar Anand</b>
                    <br>
                    A blog about python, careers &amp; life.
                    <br>
                    To contact me, <a href="https://forms.gle/Hre4z4aLqJA5zYWe6">send a message here</a>.
                </p>

            </div>
        </div>

        
    </article><!--End of body content--><footer id="footer"><div class="container align-items-center justify-content-center d-flex">

<footer class="footer"><a href="https://github.com/ChillarAnand">
<img src="../../images/icons8-github.svg" alt="github-chillar-anand" height="34"></a>

  

<a href="https://stackoverflow.com/users/2698552/chillar-anand">
<img src="../../images/icons8-so.svg" alt="github-chillar-anand" height="30"></a>

  

<a href="https://youtube.com/@avilpage">
<img src="../../images/icons8-youtube.svg" alt="github-chillar-anand" height="34"></a>

  

<a href="https://linkedin.com/in/chillaranand">
<img src="../../images/icons8-linkedin.svg" alt="github-chillar-anand" height="34"></a>

  

<a href="https://twitter.com/chillaranand">
<img src="../../images/icons8-twitter.svg" alt="github-chillar-anand" height="34"></a>

</footer>
</div>

<br><br></footer>
</div>
    </div>
    </div>

                <script src="../../assets/js/jquery.min.js"></script><script src="../../assets/js/popper.min.js"></script><script src="../../assets/js/bootstrap.min.js"></script><script src="../../assets/js/baguetteBox.min.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
    </script>
</body>
</html>
