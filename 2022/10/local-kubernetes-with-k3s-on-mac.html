<!DOCTYPE html>
<html prefix="
og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="How to setup a local kubernetes cluster on Macbook M1(apple silicon) with k3s and multipass.">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Local Kubernetes Cluster with K3s on Mac M1 | Avil Page</title>
<link href="../../assets/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/baguetteBox.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/rst.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/theme.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../rss.xml">
<link rel="canonical" href="https://avilpage.com/2022/10/local-kubernetes-with-k3s-on-mac.html">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Chillar Anand">
<link rel="prev" href="../09/how-to-root-redmi-9-prime-lancelot.html" title="How To Root Xiamo Redmi 9 Prime Without TWRP" type="text/html">
<link rel="next" href="speedup-amd64-containers-on-arm.html" title="Speed Up AMD64(Intel) VMs on ARM(M1 Mac) Host" type="text/html">
<meta property="og:site_name" content="Avil Page">
<meta property="og:title" content="Local Kubernetes Cluster with K3s on Mac M1">
<meta property="og:url" content="https://avilpage.com/2022/10/local-kubernetes-with-k3s-on-mac.html">
<meta property="og:description" content="How to setup a local kubernetes cluster on Macbook M1(apple silicon) with k3s and multipass.">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2022-10-11T08:08:36+05:30">
<meta property="article:tag" content="devops">
<meta property="article:tag" content="kubernetes">
<meta property="article:tag" content="macbook">
<style>

 h1 {
     font-weight: bold;
     font-size: 25px;
 }

</style>
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

    <!-- Menubar -->
    <nav class="navbar navbar-expand-md static-top mb-4
                navbar-dark
                bg-dark
                "><div class="container">
<!-- This keeps the margins nice -->
            <a class="navbar-brand" href="../../">

                    <span id="blog-title">Avil Page</span>
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="bs-navbar">
                <ul class="navbar-nav mr-auto">
<li class="nav-item">
<a href="../../top-10.html" class="nav-link">Top 10</a>
                </li>
<li class="nav-item">
<a href="../../archive.html" class="nav-link">Articles</a>
                </li>
<li class="nav-item">
<a href="../../p/projects.html" class="nav-link">Projects</a>
                </li>
<li class="nav-item">
<a href="../../rss.xml" class="nav-link">RSS</a>

                    
                </li>
</ul>
<ul class="navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
        </div>
<!-- /.container -->
    </nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="row justify-content-md-center">
        <div class="body-content col col-lg-6">
            <!--Body content-->
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="#" class="u-url">Local Kubernetes Cluster with K3s on Mac M1</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    Chillar Anand
            </span></p>

            <p class="dateline">


                    8 min read

            </p>

            <p class="dateline">
                <a href="#" rel="bookmark">
                    <time class="published dt-published" datetime="2022-10-11T08:08:36+05:30" itemprop="datePublished" title="2022-10-11">2022-10-11</time></a>
            </p>
            

        </div>
        
    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div class="embed-responsive embed-responsive-16by9">
<iframe class="embed-responsive-item" src="https://www.youtube.com/watch?v=vi5eRgBMs90" allowfullscreen>
</iframe>
</div>

<h4>Introduction</h4>
<p>Kubernetes(k8s)<sup id="fnref:k8s"><a class="footnote-ref" href="local-kubernetes-with-k3s-on-mac.html#fn:k8s">1</a></sup> is an open-source system for managing large scale containerized applications. K3s<sup id="fnref:k3s"><a class="footnote-ref" href="local-kubernetes-with-k3s-on-mac.html#fn:k3s">2</a></sup> is lightweight K8s in a single binary file. However, K3s won't work directly on Macbook as it needs systemd/OpenRC.</p>
<pre class="code literal-block"><span class="err">$</span><span class="w"> </span><span class="n">curl</span><span class="w"> </span><span class="o">-</span><span class="n">sfL</span><span class="w"> </span><span class="nl">https</span><span class="p">:</span><span class="o">//</span><span class="k">get</span><span class="p">.</span><span class="n">k3s</span><span class="p">.</span><span class="n">io</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">sh</span><span class="w"> </span><span class="o">-</span><span class="w"></span>

<span class="o">[</span><span class="n">ERROR</span><span class="o">]</span><span class="w">  </span><span class="n">Can</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">find</span><span class="w"> </span><span class="n">systemd</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">openrc</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">use</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">process</span><span class="w"> </span><span class="n">supervisor</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">k3s</span><span class="w"></span>
</pre>
<p>To setup k8s/k3s on Mac, we need to setup a Linux layer on top of Mac. An easy way to spin up Linux VMs on Macbook M1(Apple Silicon) is to use multipass<sup id="fnref:multipass"><a class="footnote-ref" href="local-kubernetes-with-k3s-on-mac.html#fn:multipass">3</a></sup>. In this article, lets see how to setup K3s on Mac using multipass</p>
<h4>K3s Setup</h4>
<p>Install multipass with brew by running the following command.</p>
<pre class="code literal-block">$ brew install --cask multipass
</pre>
<p>Once it is installed, spin up a new VM by specifying memory and disk space.</p>
<pre class="code literal-block">$ multipass launch --name k3s --mem 4G --disk 40G
</pre>
<p>Once VM is launched, we can see VM details.</p>
<pre class="code literal-block">$ multipass info k3s
Name:           k3s
State:          Running
IPv4:           <span class="m">192</span>.168.64.4
                <span class="m">10</span>.42.0.0
                <span class="m">10</span>.42.0.1
Release:        Ubuntu <span class="m">22</span>.04.1 LTS
Image hash:     78b5ca0da456 <span class="o">(</span>Ubuntu <span class="m">22</span>.04 LTS<span class="o">)</span>
Load:           <span class="m">1</span>.34 <span class="m">2</span>.10 <span class="m">1</span>.70
Disk usage:     <span class="m">3</span>.7G out of <span class="m">38</span>.6G
Memory usage:   <span class="m">1</span>.2G out of <span class="m">3</span>.8G
Mounts:         /Users/chillaranand/test/k8s <span class="o">=</span>&gt; ~/k8s
                    UID map: <span class="m">503</span>:default
                    GID map: <span class="m">20</span>:default
</pre>
<p>We can even mount Mac directories on the VM.</p>
<pre class="code literal-block">$ multipass mount ~/test/k8s k3s:~/k8s
</pre>
<p>This will be useful when we are making changes on host directories and want to apply changes on the cluster which is inside VM.</p>
<p>Now, we can install k3s by running the install script inside the VM.</p>
<pre class="code literal-block">$ multipass shell k3s

ubuntu@k3s:~$ curl -sfL https://get.k3s.io <span class="p">|</span> sh -
</pre>
<p>This will setup a k3s cluster on the VM. We can use kubectl and deploy applications on this cluster.</p>
<p>By default, k3s config file will be located at <code>/etc/rancher/k3s/k3s.yaml</code>. With this config file, we can use Lens<sup id="fnref:lens"><a class="footnote-ref" href="local-kubernetes-with-k3s-on-mac.html#fn:lens">4</a></sup> to manage k8s cluster.</p>
<p align="center">
<img src="../../images/k8s-mac-m1.jpg"></p>

<p>Lets find out IP of the VM &amp; k8s token so that we can spin up a new VM and add it to this cluster.</p>
<pre class="code literal-block"><span class="c1"># get token &amp; ip of k3s</span>
<span class="o">$</span> <span class="n">multipass</span> <span class="n">exec</span> <span class="n">k3s</span> <span class="n">sudo</span> <span class="n">cat</span> <span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rancher</span><span class="o">/</span><span class="n">k3s</span><span class="o">/</span><span class="n">server</span><span class="o">/</span><span class="n">node</span><span class="o">-</span><span class="n">token</span>
<span class="o">$</span> <span class="n">multipass</span> <span class="n">info</span> <span class="n">k3s</span> <span class="o">|</span> <span class="n">grep</span> <span class="o">-</span><span class="n">i</span> <span class="n">ip</span>
</pre>
<pre class="code literal-block">$ multipass launch --name k3s-worker --mem 2G --disk 20G

$ multipass shell k3s-worker

ubuntu@k3s-worker:~$ curl -sfL https://get.k3s.io <span class="p">|</span> <span class="nv">K3S_URL</span><span class="o">=</span>https://192.168.64.4:6443 <span class="nv">K3S_TOKEN</span><span class="o">=</span><span class="s2">"hs48af...947fh4::server:3tfkwjd...4jed73"</span> sh -
</pre>
<p>We can verify if the node is added correctly from k3s VM.</p>
<pre class="code literal-block"><span class="n">ubuntu</span><span class="nv">@k3s</span><span class="err">:</span><span class="o">~</span><span class="err">$</span><span class="w"> </span><span class="n">kubectl</span><span class="w"> </span><span class="k">get</span><span class="w"> </span><span class="n">nodes</span><span class="w"></span>
<span class="n">NAME</span><span class="w">         </span><span class="n">STATUS</span><span class="w">   </span><span class="n">ROLES</span><span class="w">                  </span><span class="n">AGE</span><span class="w">     </span><span class="n">VERSION</span><span class="w"></span>
<span class="n">k3s</span><span class="w">          </span><span class="n">Ready</span><span class="w">    </span><span class="n">control</span><span class="o">-</span><span class="n">plane</span><span class="p">,</span><span class="n">master</span><span class="w">   </span><span class="mi">15</span><span class="n">h</span><span class="w">     </span><span class="n">v1</span><span class="mf">.24.6</span><span class="o">+</span><span class="n">k3s1</span><span class="w"></span>
<span class="n">k3s</span><span class="o">-</span><span class="n">worker</span><span class="w">   </span><span class="n">Ready</span><span class="w">    </span><span class="o">&lt;</span><span class="k">none</span><span class="o">&gt;</span><span class="w">                 </span><span class="mi">7</span><span class="n">m15s</span><span class="w">   </span><span class="n">v1</span><span class="mf">.24.6</span><span class="o">+</span><span class="n">k3s1</span><span class="w"></span>
</pre>
<p>Once we are done with experimenting k3s, we can delete the VMs.</p>
<pre class="code literal-block">$ multipass delete k3s k3s-worker
$ multipass purge
</pre>
<h4>Conclusion</h4>
<p>multipass is a great tool to spin up Linux VMs on Mac with single command. K3s is better tool to setup k8s cluster locally for development and testing.</p>
<p>Even though we have mentioned this tutorial is meant for Mac M1, it should work fine on any Linux distribution as well.</p>
<div class="footnote">
<hr>
<ol>
<li id="fn:k8s">
<p><a href="https://en.wikipedia.org/wiki/Kubernetes">https://en.wikipedia.org/wiki/Kubernetes</a> <a class="footnote-backref" href="local-kubernetes-with-k3s-on-mac.html#fnref:k8s" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
<li id="fn:k3s">
<p><a href="https://k3s.io/">https://k3s.io/</a> <a class="footnote-backref" href="local-kubernetes-with-k3s-on-mac.html#fnref:k3s" title="Jump back to footnote 2 in the text">↩</a></p>
</li>
<li id="fn:multipass">
<p><a href="https://github.com/canonical/multipass">https://github.com/canonical/multipass</a> <a class="footnote-backref" href="local-kubernetes-with-k3s-on-mac.html#fnref:multipass" title="Jump back to footnote 3 in the text">↩</a></p>
</li>
<li id="fn:lens">
<p><a href="https://k8slens.dev/">https://k8slens.dev/</a> <a class="footnote-backref" href="local-kubernetes-with-k3s-on-mac.html#fnref:lens" title="Jump back to footnote 4 in the text">↩</a></p>
</li>
</ol>
</div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../tags/devops.html" rel="tag">devops</a></li>
            <li><a class="tag p-category" href="../../tags/kubernetes.html" rel="tag">kubernetes</a></li>
            <li><a class="tag p-category" href="../../tags/macbook.html" rel="tag">macbook</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../09/how-to-root-redmi-9-prime-lancelot.html" rel="prev" title="How To Root Xiamo Redmi 9 Prime Without TWRP">Previous post</a>
            </li>
            <li class="next">
                <a href="speedup-amd64-containers-on-arm.html" rel="next" title="Speed Up AMD64(Intel) VMs on ARM(M1 Mac) Host">Next post</a>
            </li>
        </ul></nav></aside></article><!--End of body content--><footer id="footer"><div class="container align-items-center justify-content-center d-flex">

<footer class="footer"><a href="https://github.com/ChillarAnand">
<img src="../../images/icons8-github.svg" alt="github-chillar-anand" height="34"></a>

  

<a href="https://stackoverflow.com/users/2698552/chillar-anand">
<img src="../../images/icons8-so.svg" alt="github-chillar-anand" height="30"></a>

  

<a href="https://youtube.com/@avilpage">
<img src="../../images/icons8-youtube.svg" alt="github-chillar-anand" height="34"></a>

  

<a href="https://linkedin.com/in/chillaranand">
<img src="../../images/icons8-linkedin.svg" alt="github-chillar-anand" height="34"></a>

  

<a href="https://twitter.com/chillaranand">
<img src="../../images/icons8-twitter.svg" alt="github-chillar-anand" height="34"></a>

</footer>
</div>

<br><br></footer>
</div>
    </div>
    </div>

                <script src="../../assets/js/jquery.min.js"></script><script src="../../assets/js/popper.min.js"></script><script src="../../assets/js/bootstrap.min.js"></script><script src="../../assets/js/baguetteBox.min.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
    </script>
</body>
</html>
